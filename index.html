<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Heracles' Academy</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Cinzel:wght@400;600;700&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #c9a84c;
    --gold-light: #f0d080;
    --gold-dim: #7a6230;
    --divine: #a78bfa;
    --divine-bright: #c4b5fd;
    --bg-deep: #0a0812;
    --bg-mid: #110f1a;
    --marble: #e8e0d0;
    --marble-dim: #b0a898;
    --red: #e05050;
    --green: #50c878;
    --blue: #5090e0;
    --border: rgba(201,168,76,0.25);
    --border-bright: rgba(201,168,76,0.6);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg-deep);
    color: var(--marble);
    font-family: 'Cormorant Garamond', serif;
    font-size: 15px;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed; inset: 0;
    background:
      radial-gradient(ellipse at 50% 0%, rgba(167,139,250,0.08) 0%, transparent 60%),
      radial-gradient(ellipse at 20% 80%, rgba(201,168,76,0.05) 0%, transparent 50%);
    pointer-events: none; z-index: 0;
  }

  #stars { position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; }
  .star {
    position: absolute; background: white; border-radius: 50%;
    animation: twinkle var(--d) ease-in-out infinite;
  }
  @keyframes twinkle {
    0%,100% { opacity: var(--min); transform: scale(1); }
    50% { opacity: var(--max); transform: scale(1.3); }
  }

  #battle-anim { position: fixed; inset: 0; pointer-events: none; z-index: 500; opacity: 0; }
  #battle-anim.show { animation: bflash 0.4s ease-out forwards; }
  @keyframes bflash { 0% { opacity:1; background:rgba(200,50,50,0.12); } 100% { opacity:0; } }

  /* ===== LAYOUT ===== */
  #app {
    position: relative; z-index: 1;
    display: flex; flex-direction: column;
    min-height: 100vh;
  }

  /* ===== HEADER ===== */
  #header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 14px 32px 12px;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(180deg, rgba(10,8,18,0.97) 0%, rgba(17,15,26,0.9) 100%);
    backdrop-filter: blur(12px);
    position: sticky; top: 0; z-index: 200;
    flex-shrink: 0;
  }
  .title-block { text-align: center; }
  .save-bar {
    display: flex; justify-content: center; gap: 8px; padding: 5px 0 0;
  }
  .save-btn {
    padding: 4px 12px; border-radius: 4px; font-family: 'Cinzel', serif;
    font-size: 9px; letter-spacing: 0.12em; cursor: pointer; border: 1px solid;
    transition: all 0.15s; text-transform: uppercase; background: transparent;
  }
  .save-btn.save  { border-color: rgba(201,168,76,0.5); color: var(--gold-light); background: rgba(201,168,76,0.08); }
  .save-btn.save:hover  { background: rgba(201,168,76,0.2); border-color: var(--gold); }
  .save-btn.load  { border-color: rgba(125,211,252,0.5); color: #7dd3fc; background: rgba(125,211,252,0.06); }
  .save-btn.load:hover  { background: rgba(125,211,252,0.18); border-color: #7dd3fc; }
  .save-btn.reset { border-color: rgba(252,165,165,0.4); color: #fca5a5; background: rgba(252,165,165,0.05); }
  .save-btn.reset:hover { background: rgba(252,165,165,0.15); border-color: #ef4444; }
  #save-toast {
    position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
    background: rgba(10,8,18,0.95); border: 1px solid rgba(201,168,76,0.5);
    color: var(--gold-light); font-family: 'Cinzel', serif; font-size: 11px;
    padding: 8px 20px; border-radius: 20px; pointer-events: none;
    opacity: 0; transition: opacity 0.3s; z-index: 9999; white-space: nowrap;
  }
  #save-toast.show { opacity: 1; }
  #header h1 {
    font-family: 'Cinzel Decorative', serif;
    font-size: 24px; font-weight: 900;
    color: var(--gold-light);
    text-shadow: 0 0 30px rgba(201,168,76,0.5), 0 0 60px rgba(201,168,76,0.2);
    letter-spacing: 0.05em; line-height: 1;
  }
  #header h1 span { color: var(--gold); }
  .subtitle {
    font-family: 'Cinzel', serif; font-size: 10px;
    color: var(--gold-dim); letter-spacing: 0.35em; text-transform: uppercase;
    margin-top: 3px;
  }
  .res-bar { display: flex; gap: 16px; align-items: center; }
  .res-item { display: flex; flex-direction: column; align-items: center; min-width: 72px; }
  .res-label { font-family: 'Cinzel', serif; font-size: 8px; letter-spacing: 0.2em; color: var(--gold-dim); text-transform: uppercase; }
  .res-value { font-family: 'Cinzel', serif; font-size: 15px; font-weight: 700; color: var(--gold-light); }
  .res-rate { font-size: 10px; color: var(--gold-dim); }
  .res-item.divine .res-value { color: var(--gold); }
  .res-item.dust .res-value { color: #7dd3fc; }
  .res-item.summon-res .res-value { color: #f9a8d4; }

  /* ===== NAV TABS ===== */
  #nav {
    display: flex; align-items: center; justify-content: center; gap: 0;
    background: rgba(10,8,18,0.85);
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
    position: sticky; top: 61px; z-index: 190;
  }
  .nav-tab {
    display: flex; flex-direction: column; align-items: center; gap: 2px;
    padding: 10px 28px 8px;
    font-family: 'Cinzel', serif; font-size: 9px; font-weight: 700;
    letter-spacing: 0.25em; text-transform: uppercase;
    color: var(--gold-dim); background: transparent;
    border: none; cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.2s; position: relative;
  }
  .nav-tab .tab-icon { font-size: 18px; line-height: 1; }
  .nav-tab:hover { color: var(--gold); }
  .nav-tab.active { color: var(--gold-light); border-bottom-color: var(--gold); }
  .nav-tab.active .tab-icon { filter: drop-shadow(0 0 6px rgba(201,168,76,0.7)); }
  .nav-tab .badge {
    position: absolute; top: 6px; right: 18px;
    background: var(--red); color: white; border-radius: 50%;
    width: 14px; height: 14px; font-size: 8px;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Cinzel', serif; font-weight: 700;
  }

  /* ===== CONTENT AREA ===== */
  #content {
    flex: 1; display: flex;
    overflow: hidden;
    min-height: 0;
  }

  .tab-pane {
    display: none; width: 100%;
    overflow-y: auto; padding: 24px 32px;
    height: 100%;
  }
  .tab-pane.active { display: block; }
  #pane-click.active { display: flex !important; }

  /* ===== COMMON COMPONENTS ===== */
  .pane-title {
    font-family: 'Cinzel Decorative', serif; font-size: 18px;
    color: var(--gold-light); margin-bottom: 4px;
    text-shadow: 0 0 20px rgba(201,168,76,0.3);
  }
  .pane-subtitle { font-size: 13px; color: var(--marble-dim); font-style: italic; margin-bottom: 20px; }

  .section-head {
    font-family: 'Cinzel', serif; font-size: 10px;
    letter-spacing: 0.3em; text-transform: uppercase;
    color: var(--gold); padding-bottom: 8px;
    border-bottom: 1px solid var(--border); margin-bottom: 12px; margin-top: 20px;
  }
  .section-head:first-child { margin-top: 0; }

  .section-divider { border: none; border-top: 1px solid var(--border); margin: 12px 0; }

  .card {
    background: linear-gradient(135deg, rgba(22,19,34,0.9) 0%, rgba(10,8,18,0.9) 100%);
    border: 1px solid var(--border);
    border-radius: 6px; padding: 10px 12px;
    margin-bottom: 8px; cursor: pointer;
    transition: all 0.2s; position: relative; overflow: hidden;
  }
  .card::before {
    content: ''; position: absolute; inset: 0;
    background: linear-gradient(135deg, rgba(201,168,76,0.05) 0%, transparent 60%);
    opacity: 0; transition: opacity 0.2s;
  }
  .card:hover:not(.disabled)::before { opacity: 1; }
  .card:hover:not(.disabled) { border-color: var(--border-bright); }
  .card.disabled { opacity: 0.4; cursor: not-allowed; }
  .card.locked { opacity: 0.25; cursor: not-allowed; }

  .card-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 8px; }
  .card-icon-name { display: flex; gap: 8px; align-items: center; }
  .card-icon { font-size: 22px; }
  .card-name { font-family: 'Cinzel', serif; font-size: 12px; font-weight: 600; color: var(--gold-light); line-height: 1.2; }
  .card-owned { font-family: 'Cinzel', serif; font-size: 18px; font-weight: 700; color: var(--gold); min-width: 24px; text-align: right; }
  .card-desc { font-size: 12px; color: var(--marble-dim); margin-top: 3px; font-style: italic; }
  .card-cost { display: flex; gap: 8px; margin-top: 6px; align-items: center; font-family: 'Cinzel', serif; font-size: 11px; color: var(--gold-dim); }
  .card-cost span { color: var(--gold); }
  .card-production { font-size: 11px; color: var(--green); margin-top: 2px; }

  .prog-bar { height: 3px; background: rgba(255,255,255,0.08); border-radius: 2px; margin-top: 6px; overflow: hidden; }
  .prog-fill { height: 100%; border-radius: 2px; background: linear-gradient(90deg, var(--gold-dim), var(--gold-light)); transition: width 0.3s; }

  /* ===== CLICK TAB ===== */
  #click-pane {
    display: none;
    flex-direction: column; align-items: center;
    justify-content: flex-start;
    padding: 24px 32px;
    gap: 28px;
  }
  #click-pane.active { display: flex; }

  #altar {
    width: 180px; height: 180px; border-radius: 50%;
    background: radial-gradient(circle at 40% 35%, rgba(240,208,128,0.3) 0%, rgba(201,168,76,0.1) 40%, rgba(10,8,18,0.8) 70%);
    border: 2px solid var(--gold);
    box-shadow: 0 0 40px rgba(201,168,76,0.3), inset 0 0 30px rgba(201,168,76,0.1);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    cursor: pointer; position: relative; overflow: visible;
    transition: transform 0.08s, box-shadow 0.08s; user-select: none;
  }
  #altar:hover { box-shadow: 0 0 60px rgba(201,168,76,0.5), inset 0 0 40px rgba(201,168,76,0.15); transform: scale(1.02); }
  #altar:active { transform: scale(0.96); }
  #altar .altar-icon { font-size: 64px; line-height: 1; position: relative; z-index: 2; }
  #altar .altar-label { font-family: 'Cinzel', serif; font-size: 9px; letter-spacing: 0.3em; color: var(--gold-dim); text-transform: uppercase; margin-top: 4px; position: relative; z-index: 2; }
  .altar-ring { position: absolute; inset: -2px; border-radius: 50%; border: 1px solid rgba(201,168,76,0.4); animation: rotatering 20s linear infinite; pointer-events: none; }
  .altar-ring:nth-child(2) { inset: -10px; animation-duration: 32s; animation-direction: reverse; border-color: rgba(167,139,250,0.25); }
  .altar-ring:nth-child(3) { inset: -20px; animation-duration: 48s; border-color: rgba(201,168,76,0.12); border-style: dashed; }
  @keyframes rotatering { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

  .click-stats {
    display: grid; grid-template-columns: repeat(3,1fr); gap: 16px;
    width: 100%; max-width: 560px;
  }
  .click-stat {
    background: rgba(201,168,76,0.06); border: 1px solid var(--border);
    border-radius: 6px; padding: 10px; text-align: center;
  }
  .click-stat .cs-label { font-family: 'Cinzel', serif; font-size: 9px; letter-spacing: 0.2em; color: var(--gold-dim); text-transform: uppercase; }
  .click-stat .cs-value { font-family: 'Cinzel', serif; font-size: 16px; font-weight: 700; color: var(--gold-light); margin-top: 2px; }


  /* ===== SUMMONS TAB ===== */
  .summon-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap: 12px; }
  .summon-card {
    background: linear-gradient(135deg, rgba(20,12,35,0.95) 0%, rgba(10,8,18,0.95) 100%);
    border: 1px solid rgba(167,139,250,0.25); border-radius: 8px;
    padding: 14px; cursor: pointer; transition: all 0.2s; position: relative;
  }
  .summon-card:hover:not(.disabled) { border-color: rgba(167,139,250,0.6); box-shadow: 0 0 20px rgba(167,139,250,0.1); }
  .summon-card.disabled { opacity: 0.4; cursor: not-allowed; }
  .summon-card .sc-header { display: flex; justify-content: space-between; align-items: flex-start; }
  .summon-card .sc-icon { font-size: 32px; }
  .summon-card .sc-count { font-family: 'Cinzel', serif; font-size: 22px; font-weight: 700; color: var(--gold); }
  .summon-card .sc-name { font-family: 'Cinzel', serif; font-size: 13px; color: var(--gold); margin-top: 4px; }
  .summon-card .sc-desc { font-size: 11px; color: var(--marble-dim); font-style: italic; margin: 4px 0; }
  .summon-card .sc-bonus { font-size: 11px; color: var(--green); }
  .summon-card .sc-cost { font-family: 'Cinzel', serif; font-size: 11px; color: var(--gold-dim); margin-top: 6px; }
  .summon-card .sc-cost span { color: #f9a8d4; }
  .summon-pbar { height: 3px; background: rgba(255,255,255,0.08); border-radius: 2px; margin-top: 6px; overflow: hidden; }
  .sc-stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 4px; margin: 8px 0 4px; }
  .sc-stat { display: flex; flex-direction: column; align-items: center; padding: 5px 3px; border-radius: 5px; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.07); }
  .sc-stat-label { font-size: 8px; letter-spacing: 0.12em; text-transform: uppercase; color: var(--marble-dim); font-family: 'Cinzel', serif; margin-bottom: 2px; }
  .sc-stat-icon  { font-size: 13px; line-height: 1; }
  .sc-next-stat {
  color: var(--gold);
  opacity: 0.75;
  font-size: 0.78em;
  margin-left: 2px;
}
.sc-stat-value { font-family: 'Cinzel', serif; font-size: 10px; font-weight: 700; margin-top: 2px; }
  .sc-stat.fps   .sc-stat-value { color: #7dd3fc; }
  .sc-stat.atk   .sc-stat-value { color: #fca5a5; }
  .sc-stat.hp    .sc-stat-value { color: #86efac; }
  .sc-stat.fps   { border-color: rgba(125,211,252,0.15); }
  .sc-stat.atk   { border-color: rgba(252,165,165,0.15); }
  .sc-stat.hp    { border-color: rgba(134,239,172,0.15); }
  .summon-pfill { height: 100%; border-radius: 2px; background: linear-gradient(90deg, rgba(167,139,250,0.6), var(--gold)); transition: width 0.3s; }

  /* ===== ZONE SELECTOR ===== */
  .zone-tabs {
    display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 16px;
    padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.06);
  }
  .zone-tab {
    display: flex; flex-direction: column; align-items: center;
    min-width: 68px; padding: 8px 10px; border-radius: 8px; cursor: pointer;
    border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.03);
    transition: all 0.18s; user-select: none;
  }
  .zone-tab:hover:not(.locked) { border-color: rgba(252,165,165,0.4); background: rgba(180,30,30,0.1); }
  .zone-tab.active { border-color: rgba(252,165,165,0.6); background: rgba(180,30,30,0.18); box-shadow: 0 0 12px rgba(224,80,80,0.15); }
  .zone-tab.locked { opacity: 0.4; cursor: not-allowed; }
  .zone-tab.locked:hover { border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.03); }
  .zone-tab-icon  { font-size: 18px; line-height: 1; }
  .zone-tab-name  { font-family: 'Cinzel', serif; font-size: 9px; letter-spacing: 0.1em; color: var(--marble-dim); margin-top: 3px; }
  .zone-tab-progress { font-family: 'Cinzel', serif; font-size: 10px; font-weight: 700; color: var(--gold-light); margin-top: 2px; }
  .zone-tab.active .zone-tab-progress { color: #fca5a5; }

  .zone-locked-banner {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    gap: 10px; padding: 60px 20px; text-align: center;
    border: 1px dashed rgba(255,255,255,0.1); border-radius: 12px;
    background: rgba(0,0,0,0.2);
  }
  .zone-locked-icon  { font-size: 48px; opacity: 0.4; }
  .zone-locked-title { font-family: 'Cinzel', serif; font-size: 18px; color: var(--marble-dim); }
  .zone-locked-msg   { font-family: 'Cinzel', serif; font-size: 14px; color: #fca5a5; }
  .zone-locked-sub   { font-size: 12px; color: var(--marble-dim); font-style: italic; }

  .zone-header {
    display: flex; align-items: center; gap: 14px; margin-bottom: 16px;
    padding: 12px 16px; border-radius: 8px;
    background: linear-gradient(135deg, rgba(40,10,10,0.7), rgba(10,8,18,0.7));
    border: 1px solid rgba(224,80,80,0.2);
  }
  .zone-header-icon { font-size: 32px; flex-shrink: 0; }
  .zone-header-name { font-family: 'Cinzel', serif; font-size: 15px; font-weight: 700; color: #fca5a5; }
  .zone-header-progress { font-size: 12px; color: var(--marble-dim); margin-top: 3px; }
  .zone-header-bar-wrap { flex: 1; min-width: 80px; }
  .zone-header-bar  { height: 6px; background: rgba(255,255,255,0.08); border-radius: 3px; overflow: hidden; }
  .zone-header-fill { height: 100%; border-radius: 3px; background: linear-gradient(90deg, #dc2626, #ef4444); transition: width 0.4s; }

  /* ===== TITAN BATTLES ===== */
  .titan-arena {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(300px,1fr)); gap: 16px;
  }
  .titan-card {
    background: linear-gradient(135deg, rgba(40,10,10,0.95) 0%, rgba(10,8,18,0.95) 100%);
    border: 1px solid rgba(224,80,80,0.3); border-radius: 8px; padding: 16px;
    position: relative;
  }
  .titan-card.locked-titan { opacity: 0.3; pointer-events: none; }
  .titan-stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin: 8px 0; }
  .titan-stat { display: flex; flex-direction: column; align-items: center; padding: 6px 4px; border-radius: 5px; background: rgba(255,255,255,0.03); border: 1px solid rgba(252,165,165,0.1); }
  .titan-stat-icon  { font-size: 14px; }
  .titan-stat-label { font-size: 8px; letter-spacing: 0.12em; text-transform: uppercase; font-family: 'Cinzel', serif; color: var(--marble-dim); margin: 2px 0 1px; }
  .titan-stat-value { font-family: 'Cinzel', serif; font-size: 10px; font-weight: 700; }
  .titan-stat.t-atk .titan-stat-value { color: #fca5a5; }
  .titan-stat.t-def .titan-stat-value { color: #93c5fd; }
  .titan-stat.t-hp  .titan-stat-value { color: #86efac; }
  .titan-stat.t-atk { border-color: rgba(252,165,165,0.15); }
  .titan-stat.t-def { border-color: rgba(147,197,253,0.15); }
  .titan-stat.t-hp  { border-color: rgba(134,239,172,0.15); }
  .battle-party {
    display: flex; align-items: center; gap: 8px; margin: 6px 0;
    padding: 6px 10px; background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08); border-radius: 6px;
    font-size: 11px;
  }
  .battle-party-icons { font-size: 18px; letter-spacing: 2px; }
  .battle-party-label { font-family: 'Cinzel', serif; font-size: 9px; color: var(--marble-dim); letter-spacing: 0.1em; }
  .battle-party-none { font-style: italic; color: var(--red); font-size: 10px; }
  .titan-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 6px; }
  .titan-icon { font-size: 36px; }
  .titan-name { font-family: 'Cinzel', serif; font-size: 16px; font-weight: 700; color: #fca5a5; }
  .titan-epithet { font-size: 11px; color: rgba(252,165,165,0.6); font-style: italic; }
  .titan-desc { font-size: 12px; color: var(--marble-dim); font-style: italic; margin: 6px 0 10px; }
  .hp-bar-wrap { margin: 8px 0; }
  .hp-label { font-family: 'Cinzel', serif; font-size: 10px; color: var(--marble-dim); margin-bottom: 3px; display: flex; justify-content: space-between; }
  .hp-bar { height: 12px; background: rgba(255,255,255,0.08); border-radius: 3px; overflow: hidden; }
  .hp-fill { height: 100%; background: linear-gradient(90deg, #dc2626, #ef4444); transition: width 0.3s; border-radius: 3px; }
  .hp-fill.med { background: linear-gradient(90deg, #b45309, #d97706); }
  .hp-fill.low { background: linear-gradient(90deg, #7f1d1d, #dc2626); animation: hp-pulse 0.8s ease-in-out infinite; }
  @keyframes hp-pulse { 0%,100% { opacity:1; } 50% { opacity:0.7; } }
  .battle-meta { display: flex; justify-content: space-between; align-items: center; margin: 8px 0; }
  .battle-power-txt { font-size: 11px; color: var(--blue); }
  .rewards-txt { font-size: 11px; color: var(--gold-dim); }
  .rewards-txt span { color: var(--gold); }
  .battle-btn {
    width: 100%; padding: 10px;
    background: linear-gradient(135deg, rgba(180,30,30,0.3), rgba(100,10,10,0.5));
    border: 1px solid rgba(224,80,80,0.4); border-radius: 4px;
    color: #fca5a5; font-family: 'Cinzel', serif; font-size: 11px; font-weight: 700;
    letter-spacing: 0.15em; cursor: pointer; transition: all 0.2s; margin-top: 8px;
  }
  .battle-btn:hover:not(:disabled) { background: linear-gradient(135deg, rgba(220,40,40,0.4), rgba(150,20,20,0.6)); border-color: rgba(224,80,80,0.7); }
  .battle-btn:disabled { opacity: 0.4; cursor: not-allowed; }
  .battle-btn.victory { background: linear-gradient(135deg, rgba(50,150,80,0.3), rgba(20,80,40,0.5)); border-color: rgba(80,200,120,0.4); color: #86efac; }

  /* ===== TRANSCEND ===== */
  .transcend-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; max-width: 900px; }
  .transcend-main {
    background: linear-gradient(135deg, rgba(50,20,120,0.2) 0%, rgba(10,8,18,0.9) 100%);
    border: 1px solid rgba(167,139,250,0.3); border-radius: 10px; padding: 20px;
    text-align: center;
  }
  .transcend-main h3 { font-family: 'Cinzel', serif; font-size: 13px; letter-spacing: 0.3em; color: var(--gold); text-transform: uppercase; margin-bottom: 16px; }
  .dust-orb {
    width: 120px; height: 120px; border-radius: 50%; margin: 0 auto 16px;
    background: radial-gradient(circle at 40% 35%, rgba(196,181,253,0.4) 0%, rgba(167,139,250,0.15) 50%, rgba(10,8,18,0.9) 80%);
    border: 2px solid rgba(167,139,250,0.5);
    box-shadow: 0 0 30px rgba(167,139,250,0.3), inset 0 0 20px rgba(167,139,250,0.1);
    display: flex; align-items: center; justify-content: center;
    font-size: 52px;
    animation: orb-glow 3s ease-in-out infinite;
  }
  @keyframes orb-glow { 0%,100% { box-shadow: 0 0 30px rgba(167,139,250,0.3); } 50% { box-shadow: 0 0 60px rgba(167,139,250,0.6); } }
  .transcend-stat { font-family: 'Cinzel', serif; font-size: 12px; color: var(--marble-dim); margin: 6px 0; }
  .transcend-stat strong { color: var(--gold); font-size: 16px; }
  .transcend-btn {
    width: 100%; padding: 14px;
    background: linear-gradient(135deg, rgba(100,50,200,0.35), rgba(50,20,120,0.6));
    border: 1px solid rgba(167,139,250,0.5); border-radius: 6px;
    color: var(--gold); font-family: 'Cinzel', serif; font-size: 13px; font-weight: 700;
    letter-spacing: 0.1em; cursor: pointer; transition: all 0.2s; margin-top: 16px;
  }
  .transcend-btn:hover:not(:disabled) { background: linear-gradient(135deg, rgba(140,80,255,0.45), rgba(80,30,180,0.7)); border-color: rgba(167,139,250,0.8); box-shadow: 0 0 20px rgba(167,139,250,0.2); }
  .transcend-btn:disabled { opacity: 0.35; cursor: not-allowed; }
  .transcend-upgrades-col { overflow-y: auto; }

  /* ===== SKILL TREE ===== */
  .skill-tree-wrap { position: relative; overflow-x: auto; }
  .skill-tree {
    display: flex; flex-direction: column; gap: 40px;
    padding: 20px; min-width: 700px;
    align-items: center;
  }
  .skill-row { display: flex; gap: 20px; align-items: center; justify-content: center; position: relative; }
  .skill-row-label {
    position: absolute; left: 0; top: 50%; transform: translateY(-50%);
    font-family: 'Cinzel', serif; font-size: 9px; letter-spacing: 0.2em; text-transform: uppercase;
    color: var(--gold-dim); writing-mode: horizontal-tb; white-space: nowrap;
    width: 80px; text-align: center;
  }
  .skill-node {
    width: 90px; height: 90px; border-radius: 8px;
    background: linear-gradient(135deg, rgba(22,19,34,0.95), rgba(10,8,18,0.95));
    border: 2px solid var(--border);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    gap: 3px; cursor: pointer; transition: all 0.2s; position: relative;
    text-align: center; padding: 6px;
  }
  .skill-node:hover:not(.locked-skill):not(.maxed-skill) { border-color: var(--gold); box-shadow: 0 0 15px rgba(201,168,76,0.2); }
  .skill-node.unlocked-skill { border-color: rgba(80,200,120,0.5); background: linear-gradient(135deg, rgba(20,40,20,0.95), rgba(10,20,10,0.95)); }
  .skill-node.maxed-skill { border-color: var(--gold); background: linear-gradient(135deg, rgba(40,30,10,0.95), rgba(20,15,5,0.95)); box-shadow: 0 0 20px rgba(201,168,76,0.25); }
  .skill-node.locked-skill { opacity: 0.3; cursor: not-allowed; }
  .skill-node .sn-icon { font-size: 26px; }
  .skill-node .sn-name { font-family: 'Cinzel', serif; font-size: 8px; letter-spacing: 0.05em; color: var(--gold); line-height: 1.2; }
  .skill-node .sn-level { font-family: 'Cinzel', serif; font-size: 9px; color: var(--marble-dim); }
  .skill-node.maxed-skill .sn-level { color: var(--gold); }
  .skill-connector {
    width: 2px; height: 30px; background: var(--border); margin: -20px 0;
  }
  .skill-connector.active { background: rgba(201,168,76,0.5); }
  .skill-h-connector {
    width: 20px; height: 2px; background: var(--border); flex-shrink: 0;
  }
  .skill-h-connector.active { background: rgba(201,168,76,0.5); }

  .skill-tooltip {
    position: fixed; z-index: 999;
    background: rgba(10,8,18,0.97); border: 1px solid var(--border-bright);
    border-radius: 6px; padding: 10px 14px; max-width: 220px;
    pointer-events: none; display: none;
  }
  .skill-tooltip.visible { display: block; }
  .stt-name { font-family: 'Cinzel', serif; font-size: 13px; color: var(--gold-light); margin-bottom: 4px; }
  .stt-desc { font-size: 12px; color: var(--marble-dim); font-style: italic; margin-bottom: 6px; }
  .stt-effect { font-size: 11px; color: var(--green); }
  .stt-cost { font-size: 11px; color: var(--gold-dim); margin-top: 4px; }

  /* ===== LOG ===== */
  .log-panel { max-width: 700px; }
  .log-entry { padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.04); color: var(--marble-dim); font-style: italic; font-size: 12px; }
  .log-entry.gold { color: var(--gold-dim); }
  .log-entry.divine { color: rgba(167,139,250,0.8); }
  .log-entry.battle { color: rgba(224,80,80,0.8); }
  .log-entry.victory { color: rgba(80,200,120,0.9); }

  /* Milestones */
  .milestone-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px,1fr)); gap: 10px; }
  .milestone { display: flex; gap: 8px; align-items: flex-start; padding: 8px 10px; border-radius: 4px; background: rgba(201,168,76,0.04); border: 1px solid var(--border); }
  .milestone.unlocked { background: rgba(80,200,120,0.08); border-color: rgba(80,200,120,0.25); }
  .milestone .m-icon { font-size: 18px; }
  .milestone .m-name { font-family: 'Cinzel', serif; font-size: 11px; color: var(--gold); }
  .milestone .m-desc { color: var(--marble-dim); font-size: 11px; }
  .milestone.unlocked .m-name { color: var(--green); }

  /* ===== PARTICLES ===== */
  .particle {
    position: fixed; pointer-events: none; z-index: 999;
    font-family: 'Cinzel', serif; font-size: 14px; font-weight: 700;
    color: var(--gold-light); text-shadow: 0 0 10px rgba(201,168,76,0.8);
    animation: float-up 0.9s ease-out forwards;
  }
  @keyframes float-up {
    0% { opacity: 1; transform: translateY(0) scale(1); }
    100% { opacity: 0; transform: translateY(-70px) scale(0.6); }
  }

  /* ===== AUTO-CLICK PANEL ===== */
  .autoclicker-panel {
    width: 100%; max-width: 800px;
    background: linear-gradient(135deg, rgba(14,10,30,0.95) 0%, rgba(10,8,18,0.95) 100%);
    border: 1px solid rgba(167,139,250,0.3);
    border-radius: 10px; padding: 16px 20px;
  }
  .autoclicker-header {
    display: flex; align-items: center; justify-content: space-between; gap: 12px;
    margin-bottom: 10px;
  }
  .autoclicker-title {
    font-family: 'Cinzel', serif; font-size: 12px; font-weight: 700;
    letter-spacing: 0.25em; text-transform: uppercase; color: var(--gold);
  }
  .autoclicker-status { display: flex; align-items: center; gap: 8px; }
  .ac-dot { width: 8px; height: 8px; border-radius: 50%; background: #444; flex-shrink: 0; }
  .ac-dot.active { background: var(--green); box-shadow: 0 0 8px rgba(80,200,120,0.7); animation: ac-pulse 1.2s ease-in-out infinite; }
  @keyframes ac-pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.6;transform:scale(0.8)} }
  .ac-status-text { font-family: 'Cinzel', serif; font-size: 10px; color: var(--marble-dim); letter-spacing:0.1em; }
  .ac-status-text.active { color: var(--green); }
  .ac-activate-btn {
    padding: 7px 16px;
    background: linear-gradient(135deg, rgba(100,50,200,0.3), rgba(50,20,120,0.5));
    border: 1px solid rgba(167,139,250,0.4); border-radius: 4px; color: var(--gold);
    font-family: 'Cinzel', serif; font-size: 10px; font-weight: 700;
    letter-spacing: 0.15em; cursor: pointer; transition: all 0.2s; white-space: nowrap;
  }
  .ac-activate-btn:hover:not(:disabled) { background: linear-gradient(135deg, rgba(140,80,255,0.4), rgba(80,30,180,0.6)); border-color: rgba(167,139,250,0.7); }
  .ac-activate-btn:disabled { opacity: 0.35; cursor: not-allowed; }
  .ac-body { display: flex; align-items: center; gap: 20px; flex-wrap: wrap; }
  .ac-ring-wrap { position: relative; width: 64px; height: 64px; flex-shrink: 0; }
  .ac-ring-svg { transform: rotate(-90deg); }
  .ac-ring-bg { fill: none; stroke: rgba(255,255,255,0.06); stroke-width: 5; }
  .ac-ring-fill { fill: none; stroke: var(--gold); stroke-width: 5; stroke-linecap: round; stroke-dasharray: 169; stroke-dashoffset: 169; transition: stroke-dashoffset 0.1s linear; }
  .ac-ring-fill.ready { stroke: var(--gold); filter: drop-shadow(0 0 4px rgba(201,168,76,0.6)); }
  .ac-ring-label { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-family: 'Cinzel', serif; font-size: 12px; font-weight: 700; color: var(--gold); }
  .ac-info { flex: 1; min-width: 130px; }
  .ac-interval-display { font-family: 'Cinzel', serif; font-size: 22px; font-weight: 700; color: var(--gold-light); line-height: 1; }
  .ac-interval-label { font-size: 11px; color: var(--marble-dim); margin-top: 2px; }
  .ac-next-click { font-size: 11px; color: var(--gold); margin-top: 6px; }
  .ac-upgrades { display: grid; grid-template-columns: repeat(auto-fill, minmax(190px,1fr)); gap: 8px; margin-top: 14px; border-top: 1px solid rgba(167,139,250,0.15); padding-top: 12px; }
  .ac-upg-card { background: rgba(167,139,250,0.05); border: 1px solid rgba(167,139,250,0.2); border-radius: 6px; padding: 8px 10px; cursor: pointer; transition: all 0.2s; }
  .ac-upg-card:hover:not(.disabled):not(.bought) { border-color: rgba(167,139,250,0.5); background: rgba(167,139,250,0.1); }
  .ac-upg-card.disabled { opacity: 0.35; cursor: not-allowed; }
  .ac-upg-card.bought { border-color: rgba(80,200,120,0.3); background: rgba(80,200,120,0.05); cursor: default; }
  .ac-upg-header { display: flex; align-items: center; gap: 6px; }
  .ac-upg-icon { font-size: 18px; }
  .ac-upg-name { font-family: 'Cinzel', serif; font-size: 11px; color: var(--gold); }
  .ac-upg-card.bought .ac-upg-name { color: var(--green); }
  .ac-upg-desc { font-size: 11px; color: var(--marble-dim); font-style: italic; margin-top: 3px; }
  .ac-upg-cost { font-family: 'Cinzel', serif; font-size: 10px; color: var(--gold-dim); margin-top: 4px; }
  .ac-upg-cost span { color: var(--gold); }
  .ac-upg-card.bought .ac-upg-cost { color: var(--green); }

  /* ===== ARCANE UPGRADE LEVEL CARDS ===== */
  .arcane-upg-card {
    background: linear-gradient(135deg, rgba(16,12,28,0.97) 0%, rgba(10,8,18,0.97) 100%);
    border: 1px solid rgba(201,168,76,0.2);
    border-radius: 8px; padding: 11px 13px;
    margin-bottom: 9px; cursor: pointer;
    transition: all 0.2s; position: relative; overflow: hidden;
  }
  .arcane-upg-card::after {
    content: ''; position: absolute; inset: 0;
    background: linear-gradient(135deg, rgba(201,168,76,0.04) 0%, transparent 60%);
    opacity: 0; transition: opacity 0.2s;
  }
  .arcane-upg-card:hover:not(.au-maxed):not(.au-locked)::after { opacity: 1; }
  .arcane-upg-card:hover:not(.au-maxed):not(.au-locked) { border-color: rgba(201,168,76,0.5); }
  .arcane-upg-card.au-locked { opacity: 0.3; cursor: not-allowed; }
  .arcane-upg-card.au-maxed { border-color: rgba(201,168,76,0.6); cursor: default; }
  .arcane-upg-card.au-maxed::before {
    content: ''; position: absolute; inset: 0;
    background: linear-gradient(135deg, rgba(201,168,76,0.08) 0%, transparent 70%);
  }
  .au-header { display: flex; align-items: center; gap: 8px; justify-content: space-between; }
  .au-icon-name { display: flex; align-items: center; gap: 8px; }
  .au-icon { font-size: 22px; }
  .au-name { font-family: 'Cinzel', serif; font-size: 12px; font-weight: 700; color: var(--gold-light); }
  .au-level-badge {
    display: flex; align-items: center; gap: 3px; flex-shrink: 0;
  }
  .au-pip {
    width: 7px; height: 7px; border-radius: 2px;
    background: rgba(255,255,255,0.1); border: 1px solid rgba(201,168,76,0.2);
    transition: background 0.2s;
  }
  .au-pip.filled { background: var(--gold); border-color: var(--gold); box-shadow: 0 0 4px rgba(201,168,76,0.5); }
  .au-pip.filled.maxed { background: var(--gold-light); }
  .au-desc { font-size: 12px; color: var(--marble-dim); font-style: italic; margin: 4px 0 2px; }
  .au-footer { display: flex; align-items: center; justify-content: space-between; margin-top: 6px; gap: 8px; }
  .au-effect-now { font-size: 11px; color: var(--green); }
  .au-cost { font-family: 'Cinzel', serif; font-size: 11px; color: var(--gold-dim); }
  .au-cost span { color: var(--gold); }
  .au-level-text { font-family: 'Cinzel', serif; font-size: 11px; color: var(--gold-dim); }
  .au-level-text.maxed { color: var(--gold); }
  .au-prog-bar { height: 2px; background: rgba(255,255,255,0.06); border-radius: 2px; margin-top: 6px; overflow: hidden; }
  .au-prog-fill { height: 100%; background: linear-gradient(90deg, var(--gold-dim), var(--gold)); border-radius: 2px; transition: width 0.3s; }

  /* ===== SUMMON TIERS ===== */
  .summon-tier { margin-bottom: 28px; }
  .summon-tier-header {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 14px; border-radius: 8px 8px 0 0;
    border: 1px solid; border-bottom: none;
    margin-bottom: 0;
  }
  .summon-tier-header .tier-icon { font-size: 22px; }
  .summon-tier-header .tier-label {
    font-family: 'Cinzel', serif; font-size: 13px; font-weight: 700;
    letter-spacing: 0.2em; text-transform: uppercase; flex: 1;
  }
  .summon-tier-header .tier-desc {
    font-size: 11px; font-style: italic; color: var(--marble-dim);
  }
  .tier-creatures .summon-tier-header { border-color: rgba(80,200,120,0.4); background: rgba(80,200,120,0.07); }
  .tier-creatures .summon-tier-header .tier-label { color: #86efac; }
  .tier-heroes   .summon-tier-header { border-color: rgba(201,168,76,0.4); background: rgba(201,168,76,0.07); }
  .tier-heroes   .summon-tier-header .tier-label { color: var(--gold-light); }
  .tier-gods     .summon-tier-header { border-color: rgba(167,139,250,0.4); background: rgba(167,139,250,0.07); }
  .tier-gods     .summon-tier-header .tier-label { color: var(--gold); }

  .summon-tier-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(190px,1fr));
    gap: 1px; padding: 12px;
    border: 1px solid; border-top: none; border-radius: 0 0 8px 8px;
    background: rgba(10,8,18,0.5);
  }
  .tier-creatures .summon-tier-grid { border-color: rgba(80,200,120,0.2); }
  .tier-heroes   .summon-tier-grid  { border-color: rgba(201,168,76,0.2); }
  .tier-gods     .summon-tier-grid  { border-color: rgba(167,139,250,0.2); }

  /* Reskin summon cards per tier */
  .summon-card { gap: 0; }
  .tier-creatures .summon-card { border-color: rgba(80,200,120,0.2); background: linear-gradient(135deg, rgba(15,35,20,0.97), rgba(10,8,18,0.97)); }
  .tier-creatures .summon-card:hover:not(.disabled) { border-color: rgba(80,200,120,0.6); box-shadow: 0 0 16px rgba(80,200,120,0.1); }
  .tier-creatures .sc-name  { color: #86efac; }
  .tier-creatures .sc-count { color: #86efac; }
  .tier-heroes   .summon-card { border-color: rgba(201,168,76,0.2); background: linear-gradient(135deg, rgba(30,22,8,0.97), rgba(10,8,18,0.97)); }
  .tier-heroes   .summon-card:hover:not(.disabled) { border-color: rgba(201,168,76,0.6); box-shadow: 0 0 16px rgba(201,168,76,0.1); }
  .tier-heroes   .sc-name  { color: var(--gold-light); }
  .tier-heroes   .sc-count { color: var(--gold-light); }
  .tier-gods     .summon-card { border-color: rgba(167,139,250,0.2); background: linear-gradient(135deg, rgba(20,12,35,0.97), rgba(10,8,18,0.97)); }
  .tier-gods     .summon-card:hover:not(.disabled) { border-color: rgba(167,139,250,0.6); box-shadow: 0 0 16px rgba(167,139,250,0.1); }
  .tier-gods     .sc-name  { color: var(--gold); }
  .tier-gods     .sc-count { color: var(--gold); }

  .summon-card.locked-summon { opacity: 0.25; cursor: not-allowed; pointer-events: none; }
  .summon-card.prestige-locked { opacity: 0.55; cursor: not-allowed; pointer-events: none; }
  .sc-prestige-lock {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    gap: 4px; padding: 12px 6px; text-align: center;
  }
  .sc-lock-icon  { font-size: 22px; }
  .sc-lock-text  { font-family: 'Cinzel', serif; font-size: 10px; color: #fca5a5; letter-spacing: 0.08em; }
  .sc-lock-sub   { font-size: 10px; color: var(--marble-dim); font-style: italic; }
  .locked-tier-msg {
    grid-column: 1/-1; text-align: center; padding: 12px;
    font-family: 'Cinzel', serif; font-size: 11px; letter-spacing: 0.2em;
    color: var(--marble-dim); font-style: italic;
  }

  ::-webkit-scrollbar { width: 4px; height: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--gold-dim); border-radius: 2px; }
</style>
</head>
<body>

<div id="stars"></div>
<div id="battle-anim"></div>
<div id="skill-tooltip" class="skill-tooltip"></div>

<div id="app">

  <!-- HEADER -->
  <header id="header">
    <div class="res-bar">
      <div class="res-item">
        <span class="res-label">Ley Power</span>
        <span class="res-value" id="faith-display">0</span>
        <span class="res-rate" id="faith-rate">+0/s</span>
      </div>

    </div>

    <div class="title-block">
      <h1>HERACLES' <span>ACADEMY</span></h1>
      <div class="subtitle">Train. Summon. Transcend.</div>
      <div class="save-bar">
        <button class="save-btn save"  onclick="saveGame()">üíæ Save</button>
        <button class="save-btn load"  onclick="loadGame()">üìÇ Load</button>
        <button class="save-btn reset" onclick="resetGame()">üóë Reset</button>
      </div>
    </div>
  <div id="save-toast"></div>

    <div class="res-bar" style="justify-content:flex-end">
      <div class="res-item dust">
        <span class="res-label">Arcane Dust</span>
        <span class="res-value" id="dust-display">0</span>
        <span class="res-rate" id="prestige-count">Transcensions: 0</span>
      </div>
    </div>
  </header>

  <!-- NAV TABS -->
  <nav id="nav">
    <button class="nav-tab active" onclick="switchMainTab('click')" id="nav-click">
      <span class="tab-icon">üî±</span>
      Ley Lines
    </button>
    <button class="nav-tab" onclick="switchMainTab('summons')" id="nav-summons">
      <span class="tab-icon">‚≠ê</span>
      Summons
    </button>
    <button class="nav-tab" onclick="switchMainTab('titans')" id="nav-titans">
      <span class="tab-icon">‚öîÔ∏è</span>
      Titan Battles
    </button>
    <button class="nav-tab" onclick="switchMainTab('transcend')" id="nav-transcend">
      <span class="tab-icon">‚ú®</span>
      Transcend
    </button>
    <button class="nav-tab" onclick="switchMainTab('skilltree')" id="nav-skilltree">
      <span class="tab-icon">üåø</span>
      Skill Tree
    </button>

  </nav>

  <!-- CONTENT -->
  <div id="content">

    <!-- ===== OFFERINGS (CLICK) TAB ===== -->
    <div id="pane-click" class="tab-pane active" style="display:flex;flex-direction:column;align-items:center;gap:28px;">

      <!-- Altar -->
      <div style="display:flex;flex-direction:column;align-items:center;gap:14px;padding-top:8px">
        <div id="altar" onclick="clickAltar(event)">
          <div class="altar-ring"></div>
          <div class="altar-ring"></div>
          <div class="altar-ring"></div>
          <div class="altar-icon">üî±</div>
          <div class="altar-label">The Ley Lines</div>
        </div>
        <div id="click-power-display" style="font-family:'Cinzel',serif;font-size:13px;color:var(--gold);letter-spacing:0.1em">
          +1 Ley Power per Tap
        </div>
      </div>

      <!-- Stats row -->
      <div class="click-stats">
        <div class="click-stat">
          <div class="cs-label">Ley Power / Click</div>
          <div class="cs-value" id="cs-click">1</div>
        </div>
        <div class="click-stat">
          <div class="cs-label">Ley Power / Sec</div>
          <div class="cs-value" id="cs-fps">0</div>
        </div>
        <div class="click-stat">
          <div class="cs-label">Total Earned</div>
          <div class="cs-value" id="cs-total">0</div>
        </div>
        <div class="click-stat">
          <div class="cs-label">Click Bonus</div>
          <div class="cs-value" id="cs-bonus">√ó1.00</div>
        </div>
      </div>

      <!-- Auto-Click Panel -->
      <div class="autoclicker-panel" id="autoclicker-panel">
        <div class="autoclicker-header">
          <div style="display:flex;align-items:center;gap:10px">
            <span style="font-size:20px">&#9881;&#65039;</span>
            <span class="autoclicker-title">Arcane Auto-Tap</span>
          </div>
          <div style="display:flex;align-items:center;gap:12px">
            <div class="autoclicker-status">
              <div class="ac-dot" id="ac-dot"></div>
              <span class="ac-status-text" id="ac-status-text">INACTIVE</span>
            </div>
            <button class="ac-activate-btn" id="ac-activate-btn" onclick="activateAutoClick()">
              ACTIVATE &mdash; 250 Ley Power
            </button>
          </div>
        </div>
        <div class="ac-body" id="ac-body" style="display:none">
          <div class="ac-ring-wrap">
            <svg class="ac-ring-svg" width="64" height="64" viewBox="0 0 64 64">
              <circle class="ac-ring-bg" cx="32" cy="32" r="27"/>
              <circle class="ac-ring-fill" id="ac-ring-fill" cx="32" cy="32" r="27"/>
            </svg>
            <div class="ac-ring-label" id="ac-ring-label">5.0</div>
          </div>
          <div class="ac-info">
            <div class="ac-interval-display" id="ac-interval-display">5.0s</div>
            <div class="ac-interval-label">between auto-taps</div>
            <div class="ac-next-click" id="ac-next-click">Next tap in 5.0s</div>
          </div>
          <div style="font-size:12px;color:var(--marble-dim);font-style:italic;flex:1;min-width:120px;text-align:right" id="ac-total-clicks">0 auto-taps fired</div>
        </div>
        <div class="ac-upgrades" id="ac-upgrades" style="display:none"></div>
      </div>

      <!-- Arcane Upgrades -->
      <div style="width:100%;max-width:620px">
        <div class="section-head">‚ö° Arcane Upgrades</div>
        <div id="arcane-upgrades-list"></div>
      </div>

    </div>

    <!-- ===== SUMMONS TAB ===== -->
    <div id="pane-summons" class="tab-pane">
      <div class="pane-title">Summon Chamber</div>
      <div class="pane-subtitle">Spend Ley Power to call legendary beings to your cause. Stronger tiers unlock as you progress.</div>
      <div id="summon-tiers-container"></div>
      <div class="section-head" style="margin-top:24px">‚ú¶ Active Bonds</div>
      <div id="summon-bonuses"></div>
    </div>

    <!-- ===== TITAN BATTLES TAB ===== -->
    <div id="pane-titans" class="tab-pane">
      <div class="pane-title">Titan Wars</div>
      <div class="pane-subtitle">Ten Zones of ancient power await. Defeat Titans within each zone to advance. Zones 4‚Äì10 require Transcensions to unlock.</div>
      <div id="zone-selector"></div>
      <div id="zone-content"></div>
    </div>

    <!-- ===== TRANSCEND TAB ===== -->
    <div id="pane-transcend" class="tab-pane">
      <div class="pane-title">Transcendence</div>
      <div class="pane-subtitle">Reset your progress to ascend beyond mortality. Gain Arcane Dust that permanently multiplies all output.</div>
      <div class="transcend-layout" id="transcend-content"></div>
      <hr class="section-divider" style="margin:32px 0;max-width:900px">
      <div class="pane-subtitle" style="margin-bottom:16px">üìú Chronicle of Olympus</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;max-width:900px">
        <div>
          <div class="section-head">üìú Recent Events</div>
          <div id="log-list"></div>
        </div>
        <div>
          <div class="section-head">üèÜ Milestones</div>
          <div class="milestone-grid" id="milestones-list"></div>
        </div>
      </div>
    </div>

    <!-- ===== SKILL TREE TAB ===== -->
    <div id="pane-skilltree" class="tab-pane">
      <div class="pane-title">Skill Trees</div>
      <div class="pane-subtitle">Three independent skill trees ‚Äî Creatures, Heroes, and Gods. Earn Skill Points from milestones.</div>
      <div style="display:flex;gap:16px;margin-bottom:16px;align-items:center">
        <div style="font-family:'Cinzel',serif;font-size:12px;color:var(--gold)">Skill Points Available: <span id="sp-display" style="color:var(--gold-light)">0</span></div>
        <div style="font-size:12px;color:var(--marble-dim)">Hover nodes for details. Click to purchase.</div>
      </div>
      <div class="skill-tree-wrap">
        <div class="skill-tree" id="skill-tree"></div>
      </div>
    </div>



  </div><!-- /content -->
</div><!-- /app -->

<script>
// =====================================================
// GAME STATE
// =====================================================
const G = {
  faith: 0, faithTotal: 0, faithPerClick: 1, faithPerSec: 0,
  dust: 0,
  prestiges: 0, divineMultiplier: 1, selectedZone: 1,
  skillPoints: 0, totalSkillPoints: 0,
  tick: 0, currentTab: 'click', totalClicks: 0,
};



// =====================================================
// CLICK UPGRADES
// =====================================================


// =====================================================
// GEN UPGRADES
// =====================================================
const GEN_UPGRADES = [
  { id:'gu5', name:'Ambrosia Ritual',   icon:'üçá', desc:'All production √ó1.5.',             cost:250000,currency:'faith', effect:'globalMult1.5',  bought:false, req:()=>G.faithTotal>=100000 },
  { id:'gu6', name:'Divine Nectar',     icon:'üè∫', desc:'All production √ó2.',               cost:30,    currency:'dust', effect:'globalMult2',    bought:false, req:()=>G.dust>=20 },
  { id:'gu7', name:'War Hymn',          icon:'üé∫', desc:'Battle damage √ó2.',                cost:5,     currency:'dust', effect:'battleMult2',   bought:false, req:()=>G.dust>=3 },
  { id:'gu8', name:"Titan's Bane",      icon:'üíÄ', desc:'Arcane Dust gains √ó2.',             cost:3,     currency:'dust', effect:'dustMult2',     bought:false, req:()=>G.dust>=1 },
];

// =====================================================
// ARCANE UPGRADES (leveled, shown in Arcane Upgrades column)
// =====================================================
const ARCANE_UPGRADES = [
  {
    id:'au1', name:'Surge Channeling', icon:'‚ö°',
    desc:'+50% click power per level.',
    effect:'clickMult0.5_per_level',
    maxLevel:10, level:0,
    baseCost:800, costMult:6,
    currency:'faith',
    req:()=>G.faithTotal >= 200,
  },
  {
    id:'au2', name:'Ley Conduit', icon:'üåÄ',
    desc:'√ó3 Click Power per level.',
    effect:'clickMult3_per_level',
    maxLevel:10, level:0,
    baseCost:600, costMult:7,
    currency:'faith',
    req:()=>G.faithTotal >= 100,
  },
  {
    id:'au3', name:'Summon Resonance', icon:'‚≠ê',
    desc:'Summons grant +50% Ley Power/s per level.',
    effect:'summonFpsMult0.5_per_level',
    maxLevel:8, level:0,
    baseCost:2000, costMult:8,
    currency:'faith',
    req:()=>SUMMONS.some(s=>s.owned>0),
  },
  {
    id:'au4', name:'Flux Absorption', icon:'üîÑ',
    desc:'+10% of Ley Power/s added to each click per level.',
    effect:'fpsToClick0.1_per_level',
    maxLevel:8, level:0,
    baseCost:5000, costMult:9,
    currency:'faith',
    req:()=>G.faithTotal >= 3000,
  },
  {
    id:'au5', name:'Bound Champion', icon:'üõ°Ô∏è',
    desc:'+5% summon Attack & HP per level.',
    effect:'summonCombat0.05_per_level',
    maxLevel:10, level:0,
    baseCost:1500, costMult:7,
    currency:'faith',
    req:()=>G.faithTotal >= 1500,
  },
  {
    id:'au6', name:"Titan's Tribute", icon:'üíé',
    desc:'Titans drop +25% Ley Power per level.',
    effect:'titanLeyDrop0.25_per_level',
    maxLevel:8, level:0,
    baseCost:5, costMult:6,
    currency:'dust',
    req:()=>G.dust >= 1,
  },
];

function arcaneUpgradeCost(au) {
  return Math.floor(au.baseCost * Math.pow(au.costMult, au.level));
}

function arcaneUpgradeMults() {
  const r = { clickMult:1, fpsFlat:0, summonFpsMult:1, fpsToClickPct:0, summonCombat:1, titanLeyMult:1 };
  ARCANE_UPGRADES.forEach(au => {
    if (au.level === 0) return;
    if (au.effect === 'clickMult0.5_per_level')      r.clickMult      += 0.5 * au.level;
    if (au.effect === 'clickMult3_per_level')           r.clickMult      *= Math.pow(3, au.level);
    if (au.effect === 'summonFpsMult0.5_per_level')   r.summonFpsMult  += 0.5 * au.level;
    if (au.effect === 'fpsToClick0.1_per_level')      r.fpsToClickPct  += 0.1 * au.level;
    if (au.effect === 'summonCombat0.05_per_level')   r.summonCombat   += 0.05* au.level;
    if (au.effect === 'titanLeyDrop0.25_per_level')   r.titanLeyMult   += 0.25* au.level;
  });
  return r;
}

function buyArcaneUpgrade(id) {
  const au = ARCANE_UPGRADES.find(u=>u.id===id);
  if (!au || au.level >= au.maxLevel) return;
  const cost = arcaneUpgradeCost(au);
  const val = au.currency==='faith'?G.faith : G.dust;
  if (val < cost) return;
  if (au.currency==='faith') G.faith -= cost;
  else G.dust -= cost;
  au.level++;
  log(`Arcane upgrade: ${au.name} reached level ${au.level}!`, 'divine');
  renderClickTab(); updateHeader();
}

// =====================================================
// PRESTIGE UPGRADES
// =====================================================
const PRESTIGE_UPGRADES = [
  { id:'p1', name:'Godhood Spark',   icon:'üåü', desc:'+50% all Ley Power per transcension.', cost:1, currency:'dust', effect:'divPerAsc', bought:false, req:()=>G.dust>=1 },
  { id:'p3', name:'Olympian Grace',  icon:'‚ö°', desc:'Click power √ó10 permanently.',     cost:5, currency:'dust', effect:'clickMult10', bought:false, req:()=>G.dust>=5 },
];

const ALL_UPGRADES = [...GEN_UPGRADES, ...PRESTIGE_UPGRADES];

// =====================================================
// SUMMONS ‚Äî three tiers: Creatures, Heroes, Gods
// =====================================================
const SUMMON_TIERS = [
  {
    id: 'creatures', label: 'Creatures', icon: 'üêæ',
    color: 'rgba(80,200,120,',
    desc: 'Wild beasts of myth bound to your service.',
    members: [
      { id:'sc1', name:'Faerie',   icon:'üßö', desc:'Sprites of the forest weave ley threads.',       bonus:'+0.8% Ley/s',         effect:'fps0.008',    baseFPS:3,         baseAtk:5,       baseHP:25,       baseCost:150,       costMult:1.25, owned:0, maxOwned:10, prestigeReq:0 },
      { id:'sc2', name:'Nymph',    icon:'üåø', desc:'Nature spirits amplify arcane flow.',             bonus:'+1.2% Ley/s',         effect:'fps0.012',    baseFPS:8,         baseAtk:15,      baseHP:75,       baseCost:700,      costMult:1.25, owned:0, maxOwned:10, prestigeReq:0 },
      { id:'sc3', name:'Satyr',    icon:'üêê', desc:'Wild revellers stir the ley lines.',              bonus:'+0.8% click power',   effect:'click0.008',  baseFPS:25,        baseAtk:40,      baseHP:250,      baseCost:4000,     costMult:1.25, owned:0, maxOwned:10, prestigeReq:0 },
      { id:'sc4', name:'Centaur',  icon:'üèπ', desc:'Half-man archers scout Titan weaknesses.',        bonus:'+1.2% battle power',  effect:'battle0.012', baseFPS:80,        baseAtk:120,     baseHP:750,      baseCost:30000,     costMult:1.25, owned:0, maxOwned:10, prestigeReq:0 },
      { id:'sc5', name:'Griffin',  icon:'ü¶Ö', desc:'Noble guardians soar above the battlefield.',     bonus:'+1.5% Titan damage',  effect:'titan0.015',  baseFPS:250,       baseAtk:400,     baseHP:2500,     baseCost:300000,    costMult:1.25, owned:0, maxOwned:10, prestigeReq:0 },
      { id:'sc6', name:'Minotaur', icon:'üêÇ', desc:'The labyrinth beast charges into Titans.',        bonus:'+2% click power',     effect:'click0.02',  baseFPS:750,       baseAtk:1200,    baseHP:8000,     baseCost:5000000,   costMult:1.25, owned:0, maxOwned:10, prestigeReq:0 },
      { id:'sc7', name:'Hydra',    icon:'üêç', desc:'Each head channels a separate ley current.',      bonus:'+2.5% Ley/s',         effect:'fps0.025',    baseFPS:3000,      baseAtk:4000,    baseHP:50000,    baseCost:150000000,  costMult:1.25, owned:0, maxOwned:10, prestigeReq:0 },
    ]
  },
  {
    id: 'heroes', label: 'Heroes', icon: '‚öîÔ∏è',
    color: 'rgba(201,168,76,',
    desc: 'Legendary warriors whose deeds shake the world.',
    members: [
      { id:'sh1', name:'Odysseus', icon:'üåä', desc:'The cunning wanderer turns strategy into power.',    bonus:'+15% Ley/s',          effect:'fps0.15',    baseFPS:10000,     baseAtk:12000,   baseHP:150000,   baseCost:2000000000,     costMult:1.25, owned:0, maxOwned:25, prestigeReq:1  },
      { id:'sh2', name:'Achilles', icon:'üõ°Ô∏è', desc:'Nearly invincible, his presence emboldens allies.', bonus:'+20% battle power',   effect:'battle0.20', baseFPS:50000,     baseAtk:75000,   baseHP:800000,   baseCost:30000000000,    costMult:1.25, owned:0, maxOwned:25, prestigeReq:2  },
      { id:'sh3', name:'Perseus',  icon:'üó°Ô∏è', desc:'Slayer of monsters; Titans tremble at his name.',   bonus:'+25% Titan damage',   effect:'titan0.25',  baseFPS:450000,    baseAtk:600000,  baseHP:6000000,  baseCost:750000000000,    costMult:1.28, owned:0, maxOwned:25, prestigeReq:3  },
      { id:'sh4', name:'Heracles', icon:'ü¶Å', desc:'His twelve labours multiply your output tenfold.',   bonus:'+30% all production', effect:'global0.30', baseFPS:6000000,   baseAtk:9000000, baseHP:90000000, baseCost:25000000000000,   costMult:1.3,  owned:0, maxOwned:25, prestigeReq:4  },
      { id:'sh5', name:'Theseus',  icon:'üåÄ', desc:'Navigator of the labyrinth unlocks hidden power.',   bonus:'+35% click power',    effect:'click0.35',  baseFPS:150000000, baseAtk:250000000,baseHP:3000000000,baseCost:2000000000000000,   costMult:1.3,  owned:0, maxOwned:25, prestigeReq:6  },
      { id:'sh6', name:'Jason',    icon:'üêè', desc:'The Golden Fleece amplifies ley flow greatly.',      bonus:'+40% Ley/s',          effect:'fps0.40',    baseFPS:6000000000,baseAtk:9000000000,baseHP:110000000000,baseCost:225000000000000000,  costMult:1.35, owned:0, maxOwned:25, prestigeReq:8  },
    ]
  },
  {
    id: 'gods', label: 'Gods', icon: '‚ú®',
    color: 'rgba(167,139,250,',
    desc: 'Olympian deities whose favour reshapes reality.',
    members: [
      { id:'sg1', name:'Hermes',   icon:'ü™Ω', desc:'Messenger of gods, swift conduit of ley power.',    bonus:'+20% Ley/s',          effect:'fps0.20',    baseFPS:1.5e11,    baseAtk:2.5e11,  baseHP:3e12,     baseCost:2e19,   costMult:1.3,  owned:0, maxOwned:50, prestigeReq:7  },
      { id:'sg2', name:'Athena',   icon:'ü¶â', desc:'Goddess of wisdom doubles arcane efficiency.',       bonus:'+25% all production', effect:'global0.25', baseFPS:1.2e13,    baseAtk:1.8e13,  baseHP:2.5e14,   baseCost:4.5e21,   costMult:1.32, owned:0, maxOwned:50, prestigeReq:8  },
      { id:'sg3', name:'Apollo',   icon:'‚òÄÔ∏è', desc:'Sun god bathes the ley lines in radiant energy.',    bonus:'+40% Ley/s',          effect:'fps0.40',    baseFPS:1.5e15,    baseAtk:2.25e15, baseHP:3e16,     baseCost:2e24,  costMult:1.35, owned:0, maxOwned:50, prestigeReq:9  },
      { id:'sg4', name:'Poseidon', icon:'üî±', desc:'Lord of seas floods the grid with tidal power.',     bonus:'+50% battle power',   effect:'battle0.50', baseFPS:4e17,      baseAtk:6e17,    baseHP:8e18,     baseCost:1.5e28,  costMult:1.35, owned:0, maxOwned:50, prestigeReq:10 },
      { id:'sg5', name:'Hades',    icon:'üíÄ', desc:'Ruler of the dead; souls fuel endless ley flow.',    bonus:'+60% Titan damage',   effect:'titan0.60',  baseFPS:2e19,      baseAtk:3e20,    baseHP:3e21,     baseCost:2.5e31, costMult:1.4,  owned:0, maxOwned:50, prestigeReq:11 },
      { id:'sg6', name:'Zeus',     icon:'‚ö°', desc:'King of Olympus ‚Äî his lightning is all power.',      bonus:'√ó2 everything',       effect:'global1.0',  baseFPS:5e22,      baseAtk:8e23,    baseHP:8e24,     baseCost:2e35, costMult:1.5,  owned:0, maxOwned:50, prestigeReq:12 },
    ]
  },
];

// Flat list of all summons for compatibility with summonMults / buySummon etc.
const SUMMONS = SUMMON_TIERS.flatMap(t => t.members);

// Get top N summons by total combat contribution (atk * owned)
function levelScaling(owned) { return Math.pow(1.1, owned); }

function getBestSummons(n) {
  const am = arcaneUpgradeMults();
  const sm = summonMults();
  const globalMult = G.divineMultiplier * sm.globalMult * am.summonCombat;
  return SUMMONS
    .filter(s => s.owned > 0)
    .map(s => {
      const ls = levelScaling(s.owned);
      const ssm2 = summonSkillMults();
      const tier2 = summonTierOf(s);
      const ta = ssm2[tier2]?.atk || 1;
      const th = ssm2[tier2]?.hp  || 1;
      return {
        ...s,
        totalAtk: s.baseAtk * s.owned * ls * globalMult * sm.battleMult * ta,
        totalHP:  s.baseHP  * s.owned * ls * globalMult * th,
      };
    })
    .sort((a, b) => b.totalAtk - a.totalAtk)
    .slice(0, n);
}

// Total attack power of best N summons
function bestSummonsAtk(n) {
  return getBestSummons(n).reduce((sum, s) => sum + s.totalAtk, 0);
}

// Calculate effective per-unit stats for a summon, scaled by bonuses
function calcSummonStats(s) {
  if (!s || s.owned === 0) return { fps: 0, atk: 0, hp: 0 };
  const am = arcaneUpgradeMults();
  const sm = summonMults();
  const globalMult = G.divineMultiplier * sm.globalMult * am.summonCombat;
  // Each owned unit's contribution, scaled by 1.1^owned (10% per level)
  const ls = levelScaling(s.owned);
  const ssm = summonSkillMults();
  const tier = summonTierOf(s);
  const tierFps = ssm[tier]?.fps || 1;
  const tierAtk = ssm[tier]?.atk || 1;
  const tierHp  = ssm[tier]?.hp  || 1;
  const fpsPerUnit = (s.baseFPS || 0) * ls * globalMult * sm.fpsMult * am.summonFpsMult * tierFps;
  const atkPerUnit = (s.baseAtk || 0) * ls * globalMult * am.summonCombat * sm.battleMult * tierAtk;
  const hpPerUnit  = (s.baseHP  || 0) * ls * globalMult * am.summonCombat * tierHp;
  return { fps: fpsPerUnit, atk: atkPerUnit, hp: hpPerUnit };
}

// =====================================================
// TITANS
// =====================================================
// Zone prestige requirements: zones 1-3 = 0, zone 4 = 1, 5 = 3, 6 = 5, 7 = 7, 8 = 9, 9 = 11, 10 = 12
const TITAN_ZONES = [
  {
    zone: 1, name: 'The Mortal Realm', icon: 'üåÖ', prestigeReq: 0,
    titans: [
      { id:'t1_1', name:'Coeus',      icon:'üåå', epithet:'Titan of Intellect',      desc:'Guardian of the celestial axis, keeper of the north pole of heaven.',  maxHP:800, baseAtk:60, baseDef:25,     reward:{faith:9000}, req:0 },
      { id:'t1_2', name:'Crius',      icon:'‚≠ê', epithet:'Titan of Constellations', desc:'Ruler of the stars and constellations in the heavens.',                  maxHP:2000, baseAtk:168, baseDef:55,    reward:{faith:24000}, req:1 },
      { id:'t1_3', name:'Kronos',     icon:'‚è≥', epithet:'Lord of Time',            desc:'Father of the Olympian gods, devourer of his own children.',             maxHP:5000, baseAtk:470, baseDef:121,    reward:{faith:90000}, req:2 },
      { id:'t1_4', name:'Mnemosyne',  icon:'üìú', epithet:'Titaness of Memory',      desc:'Mother of the nine Muses, keeper of all remembrance.',                   maxHP:12500, baseAtk:1317, baseDef:266,   reward:{faith:300000}, req:3 },
      { id:'t1_5', name:'Oceanus',    icon:'üåä', epithet:'Lord of the World Ocean', desc:'The great river encircling the earth, first among all waters.',           maxHP:31250, baseAtk:3688, baseDef:586,   reward:{faith:1050000}, req:4 },
    ]
  },
  {
    zone: 2, name: 'The Ashen Fields', icon: 'üåæ', prestigeReq: 0,
    titans: [
      { id:'t2_1', name:'Hyperion',   icon:'üîÜ', epithet:'Titan of Light',          desc:'Father of the sun, moon, and dawn, lord of heavenly light.',              maxHP:2000, baseAtk:180, baseDef:50,  reward:{faith:3000000}, req:0 },
      { id:'t2_2', name:'Iapetus',    icon:'üèîÔ∏è', epithet:'Titan of Mortality',      desc:'Piercer of the mortal flesh, father of Prometheus and Atlas.',            maxHP:5000, baseAtk:504, baseDef:110,  reward:{faith:9000000}, req:1 },
      { id:'t2_3', name:'Tethys',     icon:'üíß', epithet:'Titaness of Fresh Water', desc:'Mother of rivers and rain clouds, wife of great Oceanus.',                 maxHP:12500, baseAtk:1411, baseDef:242,  reward:{faith:24000000}, req:2 },
      { id:'t2_4', name:'Theia',      icon:'üíé', epithet:'Titaness of Sight',       desc:'Goddess who endowed gold and silver with their brilliance.',               maxHP:31250, baseAtk:3951, baseDef:532, reward:{faith:60000000}, req:3 },
      { id:'t2_5', name:'Phoebe',     icon:'üåô', epithet:'Titaness of the Moon',    desc:'Bright intellect of prophecy, grandmother of Apollo and Artemis.',         maxHP:78125, baseAtk:11064, baseDef:1171, reward:{faith:180000000}, req:4 },
    ]
  },
  {
    zone: 3, name: 'The Iron Wastes', icon: '‚õìÔ∏è', prestigeReq: 0,
    titans: [
      { id:'t3_1', name:'Atlas',      icon:'üåç', epithet:'Bearer of the Heavens',   desc:'Condemned to hold the celestial sphere upon his mighty shoulders.',        maxHP:3000, baseAtk:220, baseDef:60,  reward:{faith:450000000,  souls:1200}, req:0 },
      { id:'t3_2', name:'Epimetheus', icon:'üéÅ', epithet:'Titan of Afterthought',   desc:'Who opened Pandora\'s box and loosed all evils upon the world.',           maxHP:7500, baseAtk:616, baseDef:132,    reward:{faith:1200000000,    souls:1950}, req:1 },
      { id:'t3_3', name:'Prometheus', icon:'üî•', epithet:'The Fire-Bringer',        desc:'Stole sacred fire from Olympus and gave it to suffering mortals.',         maxHP:18750, baseAtk:1725, baseDef:290,    reward:{faith:3600000000,  souls:3000},req:2 },
      { id:'t3_4', name:'Menoetius',  icon:'üí¢', epithet:'Titan of Rash Action',    desc:'Struck down by Zeus for his hubris and violence at the War of Titans.',    maxHP:46875, baseAtk:4829, baseDef:639,    reward:{faith:10500000000,  souls:4800},req:3 },
      { id:'t3_5', name:'Typhon',     icon:'üåÄ', epithet:'Father of Monsters',      desc:'The most fearsome creature in all Greek mythology, nearly slew Zeus.',     maxHP:117188, baseAtk:13522, baseDef:1406,    reward:{faith:30000000000,    souls:7500},req:4 },
    ]
  },
  {
    zone: 4, name: 'The Scorched Peaks', icon: 'üåã', prestigeReq: 1,
    titans: [
      { id:'t4_1', name:'Enceladus',  icon:'üóª', epithet:'Titan of Volcanoes',      desc:'Trapped beneath Mount Etna, his writhing causes earthquakes to shake.',    maxHP:6681, baseAtk:484, baseDef:107,  reward:{faith:75000000000,  souls:12000},req:0 },
      { id:'t4_2', name:'Polybotes',  icon:'üêç', epithet:'Titan of the Deep Sea',   desc:'Crushed beneath the island of Nisyros by the god Poseidon himself.',       maxHP:16702, baseAtk:1356, baseDef:235,    reward:{faith:210000000000,    souls:19500},req:1 },
      { id:'t4_3', name:'Porphyrion', icon:'üëë', epithet:'King of the Giants',      desc:'The greatest of all Giants, second only to Alcyoneus in terrible power.',  maxHP:41756, baseAtk:3798, baseDef:517,    reward:{faith:600000000000,   souls:30000 },req:2 },
      { id:'t4_4', name:'Alcyoneus',  icon:'ü¶¥', epithet:'Immortal Giant',          desc:'Mightiest of the Gigantes, immortal on his native soil of Pallene.',       maxHP:104389, baseAtk:10635, baseDef:1138,  reward:{faith:1500000000000,   souls:45000},req:3},
      { id:'t4_5', name:'Gaia',       icon:'üåø', epithet:'The Primordial Earth',    desc:'The Earth Mother herself, source of all life, ancient beyond reckoning.',   maxHP:260973, baseAtk:29778, baseDef:2504,    reward:{faith:4500000000000, souls:75000},req:4},
    ]
  },
  {
    zone: 5, name: 'The Sunken Depths', icon: 'üåä', prestigeReq: 3,
    titans: [
      { id:'t5_1', name:'Thalassa',   icon:'üêö', epithet:'Spirit of the Sea',       desc:'Ancient sea-spirit, mother of fish and all sea creatures by Pontus.',      maxHP:16819, baseAtk:1206, baseDef:215,    reward:{faith:12000000000000,   souls:120000 },req:0 },
      { id:'t5_2', name:'Pontus',     icon:'üåë', epithet:'God of the Deep',         desc:'The deep sea itself personified, one of the first beings to ever exist.',   maxHP:42047, baseAtk:3377, baseDef:474, reward:{faith:36000000000000, souls:195000},req:1},
      { id:'t5_3', name:'Thaumas',    icon:'üåà', epithet:'God of Sea Wonders',      desc:'Father of the rainbow goddess Iris and the Harpies of the stormwinds.',    maxHP:105117, baseAtk:9455, baseDef:1042, reward:{faith:105000000000000, souls:300000 },req:2 },
      { id:'t5_4', name:'Phorcys',    icon:'ü¶Ä', epithet:'God of Hidden Dangers',   desc:'Ancient sea god who fathered the most terrible monsters of the deep.',      maxHP:262793, baseAtk:26473, baseDef:2292, reward:{faith:300000000000000,   souls:480000},req:3},
      { id:'t5_5', name:'Ceto',       icon:'ü¶à', epithet:'Goddess of Sea Monsters', desc:'Her very name means whale or sea monster, dread mother of the Gorgons.',   maxHP:656982, baseAtk:74125, baseDef:5043, reward:{faith:900000000000000,   souls:750000},req:4 },
    ]
  },
  {
    zone: 6, name: 'The Void Between Stars', icon: 'üåå', prestigeReq: 5,
    titans: [
      { id:'t6_1', name:'Aether',     icon:'üåü', epithet:'God of the Upper Air',    desc:'The bright, glowing upper atmosphere above the clouds and grey mist.',      maxHP:47226, baseAtk:3348, baseDef:484,   reward:{faith:2.400e+15,   souls:1200000 },req:0 },
      { id:'t6_2', name:'Erebus',     icon:'üñ§', epithet:'God of Darkness',         desc:'The deep darkness of the underworld, one of the first primordial beings.',  maxHP:118064, baseAtk:9376, baseDef:1064, reward:{faith:7.500e+15, souls:1950000},req:1},
      { id:'t6_3', name:'Nyx',        icon:'üåë', epithet:'Goddess of Night',        desc:'Night itself, a shadowy figure of exceptional power and beauty.',           maxHP:295160, baseAtk:26252, baseDef:2341,   reward:{faith:2.100e+16,   souls:3000000 },req:2 },
      { id:'t6_4', name:'Chaos',      icon:'üåÄ', epithet:'The First Void',          desc:'The first thing to exist was Chaos, the yawning emptiness at the start.',   maxHP:737900, baseAtk:73504, baseDef:5149,   reward:{faith:6.000e+16,   souls:4800000},req:3},
      { id:'t6_5', name:'Tartarus',   icon:'‚õìÔ∏è', epithet:'The Abyss Itself',        desc:'The deep abyss used as a dungeon of torment for the wicked Titans.',        maxHP:1844749, baseAtk:205812, baseDef:11328, reward:{faith:1.800e+17,   souls:7500000},req:4 },
    ]
  },
  {
    zone: 7, name: 'The Fractured Olympus', icon: '‚ö°', prestigeReq: 7,
    titans: [
      { id:'t7_1', name:'Ares Fallen', icon:'üó°Ô∏è', epithet:'War God Unchained',      desc:'Stripped of Olympian grace, Ares now fights with savage unbridled fury.',   maxHP:146323, baseAtk:10259, baseDef:1199,   reward:{faith:4.500e+17, souls:12000000 },req:0 },
      { id:'t7_2', name:'Hephaestus', icon:'üî®', epithet:'Forge God Corrupted',     desc:'His forge now produces weapons of mass destruction for the void forces.',   maxHP:365808, baseAtk:28725, baseDef:2637, reward:{faith:1.350e+18, souls:19500000},req:1},
      { id:'t7_3', name:'Dionysus',   icon:'üçá', epithet:'God of Madness Unleashed',desc:'Intoxicating madness radiates from this corrupted deity of revelry.',       maxHP:914520, baseAtk:80429, baseDef:5802, reward:{faith:3.900e+18, souls:30000000 },req:2 },
      { id:'t7_4', name:'Demeter',    icon:'üåæ', epithet:'Harvest Goddess Wrathful',desc:'Her grief and rage cause eternal winter wherever she treads.',               maxHP:2286299, baseAtk:225200, baseDef:12764, reward:{faith:1.140e+19, souls:48000000},req:3},
      { id:'t7_5', name:'Apollo Dark',icon:'üåë', epithet:'God of Plague',           desc:'The sun god\'s dark twin, bringing pestilence instead of light.',           maxHP:5715747, baseAtk:630561, baseDef:28080,   reward:{faith:3.300e+19, souls:75000000},req:4 },
    ]
  },
  {
    zone: 8, name: 'The Primordial Ocean', icon: 'üî±', prestigeReq: 9,
    titans: [
      { id:'t8_1', name:'Poseidon Rex',icon:'üåä', epithet:'Unchained Sea King',     desc:'Without Olympian restraint, the seas churn with apocalyptic fury.',         maxHP:495869, baseAtk:34377, baseDef:3250, reward:{faith:9.000e+19,   souls:120000000 },req:0 },
      { id:'t8_2', name:'Hades Risen', icon:'üíÄ', epithet:'Death Unleashed',        desc:'The underworld erupts as Hades marches upon the living world above.',       maxHP:1239672, baseAtk:96256, baseDef:7149, reward:{faith:2.700e+20,   souls:195000000},req:1},
      { id:'t8_3', name:'Hera Wrathful',icon:'üëë',epithet:'Wrath of the Sky Queen', desc:'The queen of the gods, her jealousy and rage now without limit or mercy.',  maxHP:3099179, baseAtk:269516, baseDef:15729, reward:{faith:8.100e+20, souls:300000000 },req:2 },
      { id:'t8_4', name:'Athena War',  icon:'ü¶â', epithet:'Goddess of Total War',   desc:'Wisdom applied to destruction, every battle calculated to annihilate.',     maxHP:7747948, baseAtk:754645, baseDef:34603, reward:{faith:2.400e+21,   souls:480000000},req:3},
      { id:'t8_5', name:'Zeus Raging', icon:'‚õàÔ∏è', epithet:'Thunderlord Unbound',   desc:'The king of Olympus, his power unconstrained, hurls storms without mercy.', maxHP:19369869, baseAtk:2113005, baseDef:76127, reward:{faith:7.500e+21, souls:750000000},req:4 },
    ]
  },
  {
    zone: 9, name: 'The Throne of Eternity', icon: '‚ú®', prestigeReq: 11,
    titans: [
      { id:'t9_1', name:'Ananke',     icon:'üîó', epithet:'Goddess of Inevitability',desc:'The goddess of compulsion, necessity, and fate that none can escape.',      maxHP:1824466, baseAtk:125071, baseDef:9565, reward:{faith:2.100e+22,   souls:1200000000 },req:0 },
      { id:'t9_2', name:'Chronos',    icon:'‚åõ', epithet:'The Infinite Time',       desc:'Not Kronos the Titan but Chronos, time itself given terrible agency.',       maxHP:4561166, baseAtk:350200, baseDef:21044,   reward:{faith:6.000e+22,   souls:1950000000},req:1},
      { id:'t9_3', name:'Phanes',     icon:'ü•ö', epithet:'The Primordial Creator',  desc:'The first-born light, the creator deity who hatched from the cosmic egg.',   maxHP:11402915, baseAtk:980559, baseDef:46297, reward:{faith:1.800e+23,   souls:3000000000 },req:2 },
      { id:'t9_4', name:'Moirai',     icon:'üßµ', epithet:'The Three Fates Combined',desc:'The three Fates merged into a single, terrifying arbiter of all destiny.',   maxHP:28507289, baseAtk:2745566, baseDef:101853, reward:{faith:5.400e+23, souls:4800000000},req:3},
      { id:'t9_5', name:'Nemesis',    icon:'‚öñÔ∏è', epithet:'Divine Retribution',      desc:'The inescapable spirit of divine retribution and righteous indignation.',    maxHP:71268221, baseAtk:7687585, baseDef:224077, reward:{faith:1.650e+24, souls:7500000000},req:4 },
    ]
  },
  {
    zone: 10, name: 'The Seat of Creation', icon: 'üå†', prestigeReq: 12,
    titans: [
      { id:'t10_1',name:'Hemera',     icon:'‚òÄÔ∏è', epithet:'Goddess of Day',          desc:'Day itself, primordial goddess who drives away the mists of her mother Nyx.',maxHP:7242781, baseAtk:490961, baseDef:30378,   reward:{faith:4.500e+24, souls:12000000000 },req:0 },
      { id:'t10_2',name:'Eros Primal',icon:'üíò', epithet:'Primordial Love',         desc:'The first force, love as a cosmic power that drives creation ever forward.', maxHP:18106954, baseAtk:1374692, baseDef:66833,   reward:{faith:1.350e+25, souls:19500000000},req:1},
      { id:'t10_3',name:'Uranus',     icon:'üåÄ', epithet:'The Starry Heaven',       desc:'The sky and heavens personified, the primordial father, struck down by Kronos.', maxHP:45267384, baseAtk:3849138, baseDef:147032,reward:{faith:4.200e+25,souls:30000000000},req:2},
      { id:'t10_4',name:'The Void',   icon:'üï≥Ô∏è', epithet:'Unmaking Itself',         desc:'The nothingness that existed before existence, now hungry to reclaim all.', maxHP:113168460, baseAtk:10777585, baseDef:323469, reward:{faith:1.350e+26, souls:48000000000},req:3},
      { id:'t10_5',name:'Apotheosis', icon:'üåü', epithet:'The Divine Ascension',    desc:'The ultimate form of transcended power. Defeat it to become truly divine.', maxHP:282921150, baseAtk:30177239, baseDef:711633, reward:{faith:4.500e+26, souls:75000000000},req:4},
    ]
  },
];

// Flatten all titans into TITANS_DATA for compatibility, adding zone info
const TITANS_DATA = TITAN_ZONES.flatMap(z => z.titans.map(t => ({ ...t, zone: z.zone })));
const TITAN_STATE = TITANS_DATA.map(t => ({ ...t, currentHP: t.maxHP, defeated: false }));

// Get the zone object for a titan by zone number
function getTitanZone(zoneNum) { return TITAN_ZONES.find(z => z.zone === zoneNum); }

// =====================================================
// MILESTONES
// =====================================================
const MILESTONES = [
  { id:'m1', name:'First Prayer',    icon:'üôè', desc:'Click the altar once.',            check:()=>G.faithTotal>=1,                          unlocked:false, spReward:1 },
  { id:'m2', name:'Summoner',        icon:'‚≠ê', desc:'Own 10 summons total.',             check:()=>totalOwned()>=10,                         unlocked:false, spReward:1 },
  { id:'m3', name:'First Summoning', icon:'‚≠ê', desc:'Summon your first creature.',      check:()=>SUMMONS.some(s=>s.owned>0),               unlocked:false, spReward:1 },
  { id:'m4', name:'Titan Slayer',    icon:'‚öîÔ∏è', desc:'Defeat your first Titan.',         check:()=>TITAN_STATE.some(t=>t.defeated),          unlocked:false, spReward:2 },
  { id:'m5', name:'Demigod',         icon:'üåü', desc:'Earn 10,000 total Ley Power.',          check:()=>G.faithTotal>=10000,                      unlocked:false, spReward:1 },
  { id:'m6', name:'Transcended',     icon:'‚ú®', desc:'Transcend for the first time.',    check:()=>G.prestiges>=1,                           unlocked:false, spReward:3 },
  { id:'m7', name:'Titan King',      icon:'üëë', desc:'Defeat 10 Titans.',                check:()=>TITAN_STATE.filter(t=>t.defeated).length>=10,unlocked:false, spReward:2 },
  { id:'m8', name:'God of Olympus',  icon:'‚ö°', desc:'Earn 1,000,000 total Ley Power.',      check:()=>G.faithTotal>=1000000,                    unlocked:false, spReward:3 },
  { id:'m9', name:'Summoner Supreme',icon:'üå†', desc:'Own 5 different summon types.',    check:()=>SUMMONS.filter(s=>s.owned>0).length>=5,  unlocked:false, spReward:2 },
];

// =====================================================
// SKILL TREE
// =====================================================
// Three independent skill trees, one per summon tier
const SKILLS = [
  // ‚îÄ‚îÄ CREATURE TREE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'c0',  name:'Beast Call',      icon:'üêæ', tree:'creature', row:0, desc:'The first cry that summons creatures to your side.',        effect:'Unlocks creature skills',     maxLevel:1, level:0, cost:1, req:[] },

  { id:'c1',  name:'Wild Pack',       icon:'üê∫', tree:'creature', row:1, desc:'+25% creature Ley/s per level.',                           effect:'+25% creature fps',           maxLevel:5, level:0, cost:1, req:['c0'] },
  { id:'c2',  name:'Feral Strength',  icon:'ü¶¥', tree:'creature', row:1, desc:'+30% creature Atk per level.',                            effect:'+30% creature atk',           maxLevel:5, level:0, cost:1, req:['c0'] },
  { id:'c3',  name:'Thick Hide',      icon:'üõ°Ô∏è', tree:'creature', row:1, desc:'+30% creature HP per level.',                             effect:'+30% creature hp',            maxLevel:5, level:0, cost:1, req:['c0'] },

  { id:'c4',  name:'Predator Bond',   icon:'ü¶Ö', tree:'creature', row:2, desc:'+50% creature Ley/s per level.',                          effect:'+50% creature fps',           maxLevel:4, level:0, cost:2, req:['c1'] },
  { id:'c5',  name:'Pack Frenzy',     icon:'‚öîÔ∏è', tree:'creature', row:2, desc:'+60% creature Atk per level.',                            effect:'+60% creature atk',           maxLevel:4, level:0, cost:2, req:['c2'] },
  { id:'c6',  name:'Primal Armor',    icon:'ü™®', tree:'creature', row:2, desc:'+60% creature HP per level.',                             effect:'+60% creature hp',            maxLevel:4, level:0, cost:2, req:['c3'] },

  { id:'c7',  name:'Ancient Rites',   icon:'üî•', tree:'creature', row:3, desc:'Creatures cost -10% per level.',                          effect:'-10% creature cost',          maxLevel:5, level:0, cost:2, req:['c4'] },
  { id:'c8',  name:'Apex Predator',   icon:'üêâ', tree:'creature', row:3, desc:'x2 creature Atk and Ley/s per level.',                    effect:'x2 creature atk+fps',         maxLevel:3, level:0, cost:3, req:['c5'] },
  { id:'c9',  name:'Ironclad',        icon:'‚öôÔ∏è', tree:'creature', row:3, desc:'x2 creature HP per level.',                              effect:'x2 creature hp',              maxLevel:3, level:0, cost:3, req:['c6'] },

  { id:'c10', name:'Wild Apotheosis', icon:'üåø', tree:'creature', row:4, desc:'x5 all creature stats and Ley/s.',                       effect:'x5 all creature',             maxLevel:1, level:0, cost:8, req:['c7','c8','c9'] },

  // ‚îÄ‚îÄ HERO TREE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'h0',  name:'Hero Call',       icon:'‚öîÔ∏è', tree:'hero', row:0, desc:'Sound the horn that draws heroes to your banner.',             effect:'Unlocks hero skills',         maxLevel:1, level:0, cost:1, req:[] },

  { id:'h1',  name:'Battle Hymn',     icon:'üé∫', tree:'hero', row:1, desc:'+30% hero Ley/s per level.',                                  effect:'+30% hero fps',               maxLevel:5, level:0, cost:1, req:['h0'] },
  { id:'h2',  name:'Iron Discipline', icon:'üó°Ô∏è', tree:'hero', row:1, desc:'+35% hero Atk per level.',                                    effect:'+35% hero atk',               maxLevel:5, level:0, cost:1, req:['h0'] },
  { id:'h3',  name:'Stalwart Guard',  icon:'üõ°Ô∏è', tree:'hero', row:1, desc:'+35% hero HP per level.',                                     effect:'+35% hero hp',                maxLevel:5, level:0, cost:1, req:['h0'] },

  { id:'h4',  name:'Legendary Deeds', icon:'üìú', tree:'hero', row:2, desc:'+60% hero Ley/s per level.',                                  effect:'+60% hero fps',               maxLevel:4, level:0, cost:2, req:['h1'] },
  { id:'h5',  name:'Titan Slayer',    icon:'üí¢', tree:'hero', row:2, desc:'+80% hero Atk per level.',                                    effect:'+80% hero atk',               maxLevel:4, level:0, cost:2, req:['h2'] },
  { id:'h6',  name:'Undying Will',    icon:'üí´', tree:'hero', row:2, desc:'+80% hero HP per level.',                                     effect:'+80% hero hp',                maxLevel:4, level:0, cost:2, req:['h3'] },

  { id:'h7',  name:'Epic Bargain',    icon:'üè∫', tree:'hero', row:3, desc:'Heroes cost -12% per level.',                                 effect:'-12% hero cost',              maxLevel:5, level:0, cost:2, req:['h4'] },
  { id:'h8',  name:'Warriors Edge',   icon:'‚ö°', tree:'hero', row:3, desc:'x2.5 hero Atk and Ley/s per level.',                          effect:'x2.5 hero atk+fps',           maxLevel:3, level:0, cost:3, req:['h5'] },
  { id:'h9',  name:'Fortress Heart',  icon:'üè∞', tree:'hero', row:3, desc:'x2.5 hero HP per level.',                                    effect:'x2.5 hero hp',                maxLevel:3, level:0, cost:3, req:['h6'] },

  { id:'h10', name:'Legends Ascent',  icon:'üåä', tree:'hero', row:4, desc:'x5 all hero stats and Ley/s.',                               effect:'x5 all hero',                 maxLevel:1, level:0, cost:8, req:['h7','h8','h9'] },

  // ‚îÄ‚îÄ GOD TREE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  { id:'g0',  name:'Divine Invocation',icon:'‚ú®', tree:'god', row:0, desc:'Invoke the gods and open the path to divine mastery.',         effect:'Unlocks god skills',          maxLevel:1, level:0, cost:1, req:[] },

  { id:'g1',  name:'Sacred Channels', icon:'üåÄ', tree:'god', row:1, desc:'+50% god Ley/s per level.',                                    effect:'+50% god fps',                maxLevel:5, level:0, cost:1, req:['g0'] },
  { id:'g2',  name:'Olympian Wrath',  icon:'‚ö°', tree:'god', row:1, desc:'+60% god Atk per level.',                                      effect:'+60% god atk',                maxLevel:5, level:0, cost:1, req:['g0'] },
  { id:'g3',  name:'Immortal Vessel', icon:'üèõÔ∏è', tree:'god', row:1, desc:'+60% god HP per level.',                                       effect:'+60% god hp',                 maxLevel:5, level:0, cost:1, req:['g0'] },

  { id:'g4',  name:'Ley Mastery',     icon:'üíé', tree:'god', row:2, desc:'+100% god Ley/s per level.',                                   effect:'+100% god fps',               maxLevel:4, level:0, cost:2, req:['g1'] },
  { id:'g5',  name:'Divine Arsenal',  icon:'üî±', tree:'god', row:2, desc:'+120% god Atk per level.',                                     effect:'+120% god atk',               maxLevel:4, level:0, cost:2, req:['g2'] },
  { id:'g6',  name:'Eternal Form',    icon:'üåü', tree:'god', row:2, desc:'+120% god HP per level.',                                      effect:'+120% god hp',                maxLevel:4, level:0, cost:2, req:['g3'] },

  { id:'g7',  name:'Pantheon Pact',   icon:'ü§ù', tree:'god', row:3, desc:'Gods cost -15% per level.',                                    effect:'-15% god cost',               maxLevel:5, level:0, cost:2, req:['g4'] },
  { id:'g8',  name:'Zeus Thunder',    icon:'üå©Ô∏è', tree:'god', row:3, desc:'x3 god Atk and Ley/s per level.',                              effect:'x3 god atk+fps',              maxLevel:3, level:0, cost:4, req:['g5'] },
  { id:'g9',  name:'Titans Soul',     icon:'üíÄ', tree:'god', row:3, desc:'x3 god HP per level.',                                        effect:'x3 god hp',                   maxLevel:3, level:0, cost:4, req:['g6'] },

  { id:'g10', name:'Pantheons Will',  icon:'üåå', tree:'god', row:4, desc:'x8 all god stats and Ley/s. All summons +50% global.',         effect:'x8 all god + global',         maxLevel:1, level:0, cost:12, req:['g7','g8','g9'] },
];

// =====================================================
// LOG
// =====================================================
const LOG_ENTRIES = [];
function log(msg, type='') {
  LOG_ENTRIES.unshift({ msg, type });
  if (LOG_ENTRIES.length > 60) LOG_ENTRIES.pop();
}

// =====================================================
// HELPERS
// =====================================================
function totalOwned() { return SUMMONS.reduce((s,s2)=>s+s2.owned,0); }
function titansDefeated() { return TITAN_STATE.filter(t=>t.defeated).length; }
function titansDefeatedInZone(zoneNum) {
  return TITAN_STATE.filter(t=>t.zone===zoneNum && t.defeated).length;
}
function satyrUnlocked() {
  return (SUMMONS.find(s => s.id === 'sc3')?.owned || 0) >= 1;
}
function zoneUnlocked(zoneNum) {
  if (!satyrUnlocked()) return false;
  const zone = getTitanZone(zoneNum);
  if (!zone) return false;
  return G.prestiges >= zone.prestigeReq;
}

function fmt(n) {
  if (n < 1000) return Math.floor(n).toString();
  if (n < 1e6)  return (n/1000).toFixed(1)+'K';
  if (n < 1e9)  return (n/1e6).toFixed(2)+'M';
  if (n < 1e12) return (n/1e9).toFixed(2)+'B';
  if (n < 1e14) return (n/1e12).toFixed(2)+'T';
  return n.toExponential(2);
}

function summonCost(s) {
  const ssm = summonSkillMults();
  const tier = summonTierOf(s);
  const disc = ssm[tier]?.costMult || 1;
  return Math.floor(s.baseCost * Math.pow(s.costMult, s.owned) * disc);
}

function skillMults() {
  // g10 capstone gives +50% global production to all summons
  let globalMult = 1;
  const g10 = SKILLS.find(s=>s.id==='g10');
  if (g10?.level > 0) globalMult *= 1.5;
  return { clickMult:1, fpsMult:1, battleMult:1, globalMult };
}

function summonSkillMults() {
  const lv = id => SKILLS.find(s=>s.id===id)?.level || 0;
  // Creature tree
  const cFps  = Math.pow(1.25,lv('c1')) * Math.pow(1.50,lv('c4')) * Math.pow(2,lv('c8'));
  const cAtk  = Math.pow(1.30,lv('c2')) * Math.pow(1.60,lv('c5')) * Math.pow(2,lv('c8'));
  const cHp   = Math.pow(1.30,lv('c3')) * Math.pow(1.60,lv('c6')) * Math.pow(2,lv('c9'));
  const cCost = Math.pow(0.90,lv('c7'));
  const cApex = lv('c10') > 0 ? 5 : 1;
  // Hero tree
  const hFps  = Math.pow(1.30,lv('h1')) * Math.pow(1.60,lv('h4')) * Math.pow(2.5,lv('h8'));
  const hAtk  = Math.pow(1.35,lv('h2')) * Math.pow(1.80,lv('h5')) * Math.pow(2.5,lv('h8'));
  const hHp   = Math.pow(1.35,lv('h3')) * Math.pow(1.80,lv('h6')) * Math.pow(2.5,lv('h9'));
  const hCost = Math.pow(0.88,lv('h7'));
  const hApex = lv('h10') > 0 ? 5 : 1;
  // God tree
  const gFps  = Math.pow(1.50,lv('g1')) * Math.pow(2.00,lv('g4')) * Math.pow(3,lv('g8'));
  const gAtk  = Math.pow(1.60,lv('g2')) * Math.pow(2.20,lv('g5')) * Math.pow(3,lv('g8'));
  const gHp   = Math.pow(1.60,lv('g3')) * Math.pow(2.20,lv('g6')) * Math.pow(3,lv('g9'));
  const gCost = Math.pow(0.85,lv('g7'));
  const gApex = lv('g10') > 0 ? 8 : 1;
  return {
    creature: { fps: cFps*cApex, atk: cAtk*cApex, hp: cHp*cApex, costMult: cCost },
    hero:     { fps: hFps*hApex, atk: hAtk*hApex, hp: hHp*hApex, costMult: hCost },
    god:      { fps: gFps*gApex, atk: gAtk*gApex, hp: gHp*gApex, costMult: gCost },
    apex: 1,
  };
}

function summonTierOf(s) {
  if (s.id.startsWith('sc')) return 'creature';
  if (s.id.startsWith('sh')) return 'hero';
  return 'god';
}

function summonMults() {
  let fpsMult=1, battleMult=1, clickMult=1, titanMult=1, globalMult=1;
  SUMMONS.forEach(s => {
    if (s.owned===0) return;
    const n = s.owned;
    // Parse effect string: type + value, e.g. 'fps0.08', 'click0.20', 'global0.30'
    const m = s.effect.match(/^([a-z]+)([\d.]+)$/);
    if (!m) return;
    const type = m[1], val = parseFloat(m[2]);
    if (type === 'fps')     fpsMult    += val;
    if (type === 'battle')  battleMult += val;
    if (type === 'titan')   titanMult  += val;
    if (type === 'click')   clickMult  += val;
    if (type === 'global')  globalMult += val;
  });
  return { fpsMult, battleMult, clickMult, titanMult, globalMult };
}

function calcFPS() {
  const sm = summonMults();
  const sk = skillMults();
  const am = arcaneUpgradeMults();
  let globalMult = G.divineMultiplier * sm.fpsMult * am.summonFpsMult * sm.globalMult * sk.fpsMult * sk.globalMult;
  ALL_UPGRADES.filter(u=>u.bought).forEach(u => {
    if (u.effect==='globalMult1.5') globalMult*=1.5;
    if (u.effect==='globalMult2')   globalMult*=2;
  });
  const ssm3 = summonSkillMults();
  const base = SUMMONS.reduce((s, sm2) => {
    const t3 = summonTierOf(sm2);
    const tf = (ssm3[t3]?.fps || 1) * ssm3.apex;
    return s + sm2.owned * levelScaling(sm2.owned) * (sm2.baseFPS || 0) * tf;
  }, 0) * globalMult;
  return base + am.fpsFlat;
}

function calcClickPower(cachedFPS) {
  let base = G.faithPerClick, addFlat = 0, mult = G.divineMultiplier;
  const sm = summonMults();
  const sk = skillMults();
  const am = arcaneUpgradeMults();
  mult *= sm.clickMult * sk.clickMult * am.clickMult;
  ALL_UPGRADES.filter(u=>u.bought).forEach(u => {
    if (u.effect==='globalMult1.5') mult*=1.5;
    if (u.effect==='globalMult2')   mult*=2;
  });
  // au4: add % of ley/s to click (use cached fps to avoid circular call)
  if (am.fpsToClickPct > 0) {
    const fps = (cachedFPS !== undefined) ? cachedFPS : calcFPS();
    addFlat += fps * am.fpsToClickPct;
  }
  // Every 10 clicks adds +2% click power (stacks multiplicatively)
  const clickBonus = Math.pow(1.02, Math.floor(G.totalClicks / 10));
  return (base + addFlat) * mult * clickBonus;
}

function calcBattlePower() {
  const _fps = calcFPS();
  let p = _fps + calcClickPower(_fps) * 0.5;
  const sm = summonMults();
  const sk = skillMults();
  const am = arcaneUpgradeMults();
  p *= sm.battleMult * sk.battleMult * am.summonCombat;
  ALL_UPGRADES.filter(u=>u.bought&&u.effect==='battleMult2').forEach(()=>p*=2);
  return Math.max(1, p);
}



function soulMultiplier() {
  let m=1;
  const sm = summonMults();
  if (ALL_UPGRADES.find(u=>u.id==='gu8')?.bought) m*=2;
  m *= sm.titanMult;
  const sk = skillMults();
  m *= sk.battleMult; // titans scale with battle
  return Math.max(1,m);
}

const TRANSCEND_THRESHOLDS = [3e9, 25e9, 500e9, 10e12, 500e12, 30e15, 4e18, 3e20, 4e22, 4e25, 2e29, 4e32];
function getTranscendBase() {
  return TRANSCEND_THRESHOLDS[Math.min(G.prestiges, TRANSCEND_THRESHOLDS.length - 1)];
}
function calcDivinityGain() {
  const base = getTranscendBase();
  if (G.faithTotal < base) return 0;
  const mult = Math.min(3, 1 + 0.25 * Math.log2(G.faithTotal / base));
  return Math.max(1, Math.floor(mult));
}
function calcDivinityGainExact() {
  const base = getTranscendBase();
  if (G.faithTotal < base) return 0;
  return Math.min(3, 1 + 0.25 * Math.log2(G.faithTotal / base));
}

function calcDivineMultiplier() {
  let m = 1 + G.prestiges * 0.2;
  if (ALL_UPGRADES.find(u=>u.id==='p1')?.bought) m += G.prestiges * 0.3;
  return m;
}

function skillUnlocked(sk) {
  return sk.req.every(rid => SKILLS.find(s=>s.id===rid)?.level > 0);
}

// =====================================================
// ACTIONS
// =====================================================
function clickAltar(e) {
  G.totalClicks++;
  const cp = calcClickPower();
  G.faith += cp; G.faithTotal += cp;
  spawnParticle(e.clientX, e.clientY, `+${fmt(cp)}`);
  checkMilestones();
}

function spawnParticle(x, y, text) {
  const el = document.createElement('div');
  el.className = 'particle';
  el.textContent = text;
  el.style.left = (x-20+Math.random()*40-20)+'px';
  el.style.top  = (y-10)+'px';
  document.body.appendChild(el);
  setTimeout(()=>el.remove(), 900);
}

function buyUpgrade(id) {
  const up = ALL_UPGRADES.find(u=>u.id===id);
  if (!up || up.bought) return;
  const val = up.currency==='faith'?G.faith : up.currency==='souls'?G.dust : G.dust;
  if (val < up.cost) return;
  if (up.currency==='faith') G.faith -= up.cost;
  else if (up.currency==='souls') G.dust -= up.cost;
  else G.dust -= up.cost;
  up.bought = true;
  log(`Unlocked: ${up.name}!`, 'gold');
  renderAll();
}

function buySummon(id) {
  const s = SUMMONS.find(x=>x.id===id);
  if (!s || s.owned >= s.maxOwned) return;
  if (s.prestigeReq > 0 && G.prestiges < s.prestigeReq) return;
  const cost = summonCost(s);
  if (G.faith < cost) return;
  G.faith -= cost; s.owned++;
  log(`Summoned ${s.name}!`, 'divine');
  checkMilestones(); renderSummonsTab();
  updateHeader();
}

function attackTitan(id) {
  const titan = TITAN_STATE.find(t=>t.id===id);
  if (!titan || titan.defeated) return;
  // Damage = top-3 summon total Atk reduced by titan Defense, plus base battle power
  const best3  = getBestSummons(3);
  const sumAtk = best3.reduce((s, x) => s + x.totalAtk, 0);
  const sm     = summonMults();
  const sk     = skillMults();
  const am     = arcaneUpgradeMults();
  const def    = titan.baseDef || 0;
  // Defense reduces damage (min 10% still gets through)
  const defReduction = Math.max(0.1, 1 - def / (def + sumAtk * 0.5 + 1));
  const baseBP = calcBattlePower();
  let dmg = (sumAtk + baseBP) * defReduction * (0.8 + Math.random() * 0.4) * sm.titanMult;
  titan.currentHP = Math.max(0, titan.currentHP - dmg);
  document.getElementById('battle-anim').className='show';
  setTimeout(()=>document.getElementById('battle-anim').className='', 400);
  const fighters = best3.length > 0
    ? best3.map(s => s.icon).join('') + ' '
    : '‚öî ';
  log(`${fighters}struck ${titan.name} for ${fmt(dmg)} damage!`, 'battle');
  if (titan.currentHP <= 0) {
    titan.defeated = true;
    const sm2 = soulMultiplier();
    const sGain = Math.floor(titan.reward.souls * sm2);
    const am2 = arcaneUpgradeMults();
    const faithGain = Math.floor(titan.reward.faith * am2.titanLeyMult);
    G.faith += faithGain; G.faithTotal += faithGain;
    G.dust += sGain;
    spawnParticle(window.innerWidth/2, window.innerHeight/2, `${titan.name} SLAIN!`);
    log(`‚ú¶ TITAN SLAIN: ${titan.name}! +${fmt(faithGain)} Ley Power, +${sGain} Arcane Dust!`, 'victory');
    checkMilestones();
  }
  renderTitansTab(); updateHeader();
}

function doPrestige() {
  const gain = calcDivinityGain();
  if (gain < 1) return;
  if (!confirm(`Transcend now?\n\nGain ${gain} Arcane Dust.\nLey Power, summons, and non-prestige upgrades reset.`)) return;
  G.dust += gain; G.prestiges++;
  G.faith = 0; G.faithTotal = 0;
  ALL_UPGRADES.filter(u=>u.currency!=='dust').forEach(u=>u.bought=false);
  TITAN_STATE.forEach((t,i)=>{ t.defeated=false; t.currentHP=TITANS_DATA[i].maxHP; });
  G.divineMultiplier = calcDivineMultiplier();
  log(`‚òÖ TRANSCENSION ${G.prestiges}: Gained ${gain} Arcane Dust!`, 'divine');
  renderAll();
}

function buySkill(id) {
  const sk = SKILLS.find(s=>s.id===id);
  if (!sk) return;
  if (sk.level >= sk.maxLevel) return;
  if (!skillUnlocked(sk)) return;
  if (G.skillPoints < sk.cost) return;
  G.skillPoints -= sk.cost;
  sk.level++;
  log(`Trained skill: ${sk.name} (Lv ${sk.level})!`, 'divine');
  renderSkillTree();
  updateHeader();
}

function checkMilestones() {
  let changed = false;
  MILESTONES.forEach(m => {
    if (!m.unlocked && m.check()) {
      m.unlocked = true;
      G.skillPoints += m.spReward;
      G.totalSkillPoints += m.spReward;
      log(`‚òÖ Milestone: ${m.name}! (+${m.spReward} Arcane Dust)`, 'divine');
      changed = true;
    }
  });
  if (changed) { renderChronicle(); renderSkillTree(); updateHeader(); }
}

// =====================================================
// RENDER
// =====================================================
function renderClickTab() {
  if (G.currentTab !== 'click') return;

  // Stat boxes
  const cp = calcClickPower(), fps = calcFPS();
  document.getElementById('click-power-display').textContent = `+${fmt(cp)} Ley Power per Tap`;
  const csc = document.getElementById('cs-click'); if(csc) csc.textContent = fmt(cp);
  const csf = document.getElementById('cs-fps');   if(csf) csf.textContent = fmt(fps)+'/s';
  const cst = document.getElementById('cs-total'); if(cst) cst.textContent = fmt(G.faithTotal);
  const csb = document.getElementById('cs-bonus'); if(csb) csb.textContent = '√ó'+Math.pow(1.02,Math.floor(G.totalClicks/10)).toFixed(2)+' ('+G.totalClicks+' clicks)';
  renderACPanel();
  renderArcaneUpgrades();
}

function renderArcaneUpgrades() {
  const el = document.getElementById('arcane-upgrades-list');
  if (!el) return;
  const am = arcaneUpgradeMults();

  function effectSummary(au) {
    if (au.effect === 'clickMult0.5_per_level')    return au.level>0 ? `Now: +${(50*au.level)}% click power` : '+50% click power / level';
    if (au.effect === 'clickMult3_per_level')        return au.level>0 ? `Now: √ó${Math.pow(3,au.level).toLocaleString()} click power` : '√ó3 click power / level';
    if (au.effect === 'summonFpsMult0.5_per_level') return au.level>0 ? `Now: summons +${(50*au.level)}% Ley/s` : '+50% summon Ley/s / level';
    if (au.effect === 'fpsToClick0.1_per_level')    return au.level>0 ? `Now: ${(10*au.level)}% of Ley/s ‚Üí click` : '+10% Ley/s to click / level';
    if (au.effect === 'summonCombat0.05_per_level') return au.level>0 ? `Now: summons +${(5*au.level)}% Atk & HP` : '+5% summon Atk & HP / level';
    if (au.effect === 'titanLeyDrop0.25_per_level') return au.level>0 ? `Now: titans +${(25*au.level)}% Ley drop` : '+25% titan Ley drop / level';
    return '';
  }

  el.innerHTML = ARCANE_UPGRADES.map(au => {
    const unlocked = au.req();
    const maxed = au.level >= au.maxLevel;
    const cost = arcaneUpgradeCost(au);
    const val = au.currency==='faith' ? G.faith : G.dust;
    const canAfford = val >= cost;
    const lbl = au.currency==='faith' ? 'Ley Power' : 'Arcane Dust';
    const cls = maxed ? 'au-maxed' : !unlocked ? 'au-locked' : '';

    // Pip indicators
    const pips = Array.from({length: au.maxLevel}, (_,i) =>
      `<div class="au-pip ${i < au.level ? (maxed?'filled maxed':'filled') : ''}"></div>`
    ).join('');

    return `<div class="arcane-upg-card ${cls}" data-auid="${au.id}" style="cursor:${maxed||!unlocked?'default':'pointer'}">
      <div class="au-header">
        <div class="au-icon-name">
          <span class="au-icon">${au.icon}</span>
          <span class="au-name">${au.name}</span>
        </div>
        <div class="au-level-badge">${pips}</div>
      </div>
      <div class="au-desc">${au.desc}</div>
      <div class="au-footer">
        <div class="au-effect-now">${effectSummary(au)}</div>
        <div class="au-level-text ${maxed?'maxed':''}">${maxed ? '‚ú¶ MAX' : `Lv ${au.level}/${au.maxLevel}`}</div>
      </div>
      ${!maxed ? `<div class="au-cost" style="margin-top:5px">Next level: <span>${fmt(cost)} ${lbl}</span>
        ${unlocked && !canAfford ? `<span style="color:var(--red);font-size:10px;margin-left:4px">‚Äî need ${fmt(cost-val)} more</span>` : ''}</div>
        ${unlocked ? `<div class="au-prog-bar"><div class="au-prog-fill" style="width:${Math.min(100,val/cost*100)}%"></div></div>` : ''}` : ''}
    </div>`;
  }).join('');
}

function renderSummonsTab() {
  if (G.currentTab !== 'summons') return;
  const container = document.getElementById('summon-tiers-container');
  if (!container) return;

  // Each summon is individually locked/unlocked by its own prestigeReq
  // Tiers are always visible; locked cards show a prestige requirement overlay

  container.innerHTML = SUMMON_TIERS.map((tier) => {

    const cards = tier.members.map(s => {
      const prestigeLocked = s.prestigeReq > 0 && G.prestiges < s.prestigeReq;
      const cost    = summonCost(s);
      const maxed   = s.owned >= s.maxOwned;
      const canBuy  = !prestigeLocked && !maxed && G.faith >= cost;
      const cls     = prestigeLocked ? 'prestige-locked' : maxed ? '' : canBuy ? '' : 'disabled';
      const fillPct = maxed ? 100 : prestigeLocked ? 0 : Math.min(100, G.faith/cost*100);
      // Current stats (with level scaling at current owned count)
      const lsCur  = levelScaling(s.owned);
      const lsNext = levelScaling(s.owned + 1);
      function fmtStat(base, ls) {
        const v = base * ls;
        return base >= 1e6 ? fmt(v) : v >= 1000 ? (v/1000).toFixed(1)+'K' : v.toFixed(v < 1 ? 2 : 0);
      }
      const fpsVal      = fmtStat(s.baseFPS, lsCur);
      const atkVal      = fmtStat(s.baseAtk, lsCur);
      const hpVal       = fmtStat(s.baseHP,  lsCur);
      const fpsNextVal  = fmtStat(s.baseFPS, lsNext);
      const atkNextVal  = fmtStat(s.baseAtk, lsNext);
      const hpNextVal   = fmtStat(s.baseHP,  lsNext);

      if (prestigeLocked) {
        return `<div class="summon-card prestige-locked">
          <div class="sc-header">
            <span class="sc-icon">${s.icon}</span>
            <span class="sc-count" style="opacity:0.4">0/${s.maxOwned}</span>
          </div>
          <div class="sc-name">${s.name}</div>
          <div class="sc-desc">${s.desc}</div>
          <div class="sc-stats">
            <div class="sc-stat fps">
              <span class="sc-stat-icon">‚ö°</span>
              <span class="sc-stat-label">Ley/s</span>
              <span class="sc-stat-value">${fpsVal}</span>
            </div>
            <div class="sc-stat atk">
              <span class="sc-stat-icon">‚öîÔ∏è</span>
              <span class="sc-stat-label">Atk</span>
              <span class="sc-stat-value">${atkVal}</span>
            </div>
            <div class="sc-stat hp">
              <span class="sc-stat-icon">üõ°Ô∏è</span>
              <span class="sc-stat-label">HP</span>
              <span class="sc-stat-value">${hpVal}</span>
            </div>
          </div>
          <div class="sc-bonus" style="opacity:0.6">${s.bonus}</div>
          <div class="sc-prestige-lock">
            <span class="sc-lock-icon">üîí</span>
            <span class="sc-lock-text">Requires ${s.prestigeReq} Transcension${s.prestigeReq !== 1 ? 's' : ''}</span>
            <span class="sc-lock-sub">You have ${G.prestiges}</span>
          </div>
        </div>`;
      }

      return `<div class="summon-card ${cls}" data-summonid="${s.id}">
        <div class="sc-header">
          <span class="sc-icon">${s.icon}</span>
          <span class="sc-count">${s.owned}/${s.maxOwned}</span>
        </div>
        <div class="sc-name">${s.name}</div>
        <div class="sc-desc">${s.desc}</div>
        <div class="sc-stats">
          <div class="sc-stat fps">
            <span class="sc-stat-icon">‚ö°</span>
            <span class="sc-stat-label">Ley/s</span>
            <span class="sc-stat-value">${fpsVal}${!maxed ? `<span class="sc-next-stat"> ‚Üí ${fpsNextVal}</span>` : ''}</span>
          </div>
          <div class="sc-stat atk">
            <span class="sc-stat-icon">‚öîÔ∏è</span>
            <span class="sc-stat-label">Atk</span>
            <span class="sc-stat-value">${atkVal}${!maxed ? `<span class="sc-next-stat"> ‚Üí ${atkNextVal}</span>` : ''}</span>
          </div>
          <div class="sc-stat hp">
            <span class="sc-stat-icon">üõ°Ô∏è</span>
            <span class="sc-stat-label">HP</span>
            <span class="sc-stat-value">${hpVal}${!maxed ? `<span class="sc-next-stat"> ‚Üí ${hpNextVal}</span>` : ''}</span>
          </div>
        </div>
        <div class="sc-bonus">${s.bonus}</div>
        <div class="sc-cost">${maxed
          ? '<span style="color:var(--green)">‚úì Max</span>'
          : `Cost: <span>${fmt(cost)} Ley Power</span>`
        }</div>
        <div class="summon-pbar"><div class="summon-pfill" style="width:${fillPct}%"></div></div>
      </div>`;
    }).join('');

    return `<div class="summon-tier tier-${tier.id}">
      <div class="summon-tier-header">
        <span class="tier-icon">${tier.icon}</span>
        <span class="tier-label">${tier.label}</span>
        <span class="tier-desc">${tier.desc}</span>
      </div>
      <div class="summon-tier-grid">
        ${cards}
      </div>
    </div>`;
  }).join('');

  // Active bonds panel
  const bonuses = document.getElementById('summon-bonuses');
  const active = SUMMONS.filter(s=>s.owned>0);
  if (bonuses) {
    if (active.length === 0) {
      bonuses.innerHTML = '<span style="color:var(--marble-dim);font-style:italic;font-size:12px">No summons active yet.</span>';
    } else {
      const tierColors = { sc:'rgba(80,200,120,0.8)', sh:'rgba(201,168,76,0.9)', sg:'rgba(167,139,250,0.9)' };
      bonuses.innerHTML = '<div style="display:flex;flex-wrap:wrap;gap:8px">' +
        active.map(s => {
          const prefix = s.id.slice(0,2);
          const col = tierColors[prefix] || 'var(--gold)';
          return `<div style="display:flex;gap:6px;align-items:center;padding:5px 10px;border:1px solid ${col.replace('0.8','0.3').replace('0.9','0.3')};border-radius:20px;background:${col.replace('0.8','0.06').replace('0.9','0.06')}">
            <span style="font-size:16px">${s.icon}</span>
            <span style="font-family:'Cinzel',serif;font-size:10px;color:${col}">${s.name}</span>
            <span style="font-family:'Cinzel',serif;font-size:10px;color:var(--gold-dim)">√ó${s.owned}</span>
          </div>`;
        }).join('') + '</div>';
    }
  }
}

function renderTitansTab() {
  if (G.currentTab !== 'titans') return;
  if (!G.selectedZone) G.selectedZone = 1;

  const sel   = document.getElementById('zone-selector');
  const cont  = document.getElementById('zone-content');
  if (!sel || !cont) return;

  // Hard gate: must own at least 1 Satyr before Titan Wars unlock
  if (!satyrUnlocked()) {
    sel.innerHTML = '';
    cont.innerHTML = `<div class="zone-locked-banner">
      <div class="zone-locked-icon">üêê</div>
      <div class="zone-locked-title">Titan Wars Sealed</div>
      <div class="zone-locked-msg">üîí Summon a Satyr to breach the Titan realm</div>
      <div class="zone-locked-sub">The Titans stir ‚Äî they await a worthy challenger. Summon the 3rd Creature to begin.</div>
    </div>`;
    return;
  }

  const bp = calcBattlePower();

  // Zone selector tabs
  sel.innerHTML = `<div class="zone-tabs">` +
    TITAN_ZONES.map(z => {
      const unlocked  = zoneUnlocked(z.zone);
      const defeated  = titansDefeatedInZone(z.zone);
      const active    = G.selectedZone === z.zone;
      const cls = ['zone-tab', active?'active':'', !unlocked?'locked':''].filter(Boolean).join(' ');
      return `<div class="${cls}" data-zone="${z.zone}">
        <span class="zone-tab-icon">${unlocked ? z.icon : 'üîí'}</span>
        <span class="zone-tab-name">Zone ${z.zone}</span>
        <span class="zone-tab-progress">${unlocked ? defeated+'/5' : z.prestigeReq+'‚ú® req'}</span>
      </div>`;
    }).join('') +
    `</div>`;

  // Zone content
  const zone = getTitanZone(G.selectedZone);
  const unlocked = zoneUnlocked(zone.zone);

  if (!unlocked) {
    cont.innerHTML = `<div class="zone-locked-banner">
      <div class="zone-locked-icon">${zone.icon}</div>
      <div class="zone-locked-title">${zone.name}</div>
      <div class="zone-locked-msg">üîí Requires ${zone.prestigeReq} Transcension${zone.prestigeReq!==1?'s':''}</div>
      <div class="zone-locked-sub">You have ${G.prestiges} Transcension${G.prestiges!==1?'s':''}</div>
    </div>`;
    return;
  }

  const zoneDefeated = titansDefeatedInZone(zone.zone);
  cont.innerHTML = `
    <div class="zone-header">
      <span class="zone-header-icon">${zone.icon}</span>
      <div>
        <div class="zone-header-name">Zone ${zone.zone}: ${zone.name}</div>
        <div class="zone-header-progress">${zoneDefeated}/5 Titans slain</div>
      </div>
      <div class="zone-header-bar-wrap">
        <div class="zone-header-bar"><div class="zone-header-fill" style="width:${zoneDefeated/5*100}%"></div></div>
      </div>
    </div>
    <div class="titan-arena">` +
    zone.titans.map((tData, i) => {
      const titan   = TITAN_STATE.find(t => t.id === tData.id);
      const prevSlain = i === 0 ? true : TITAN_STATE.find(t => t.id === zone.titans[i-1].id)?.defeated;
      const locked  = !prevSlain && i > 0;
      if (locked) return `<div class="titan-card locked-titan">
        <div class="titan-header"><div>
          <div class="titan-name">üîí ${tData.name}</div>
          <div class="titan-epithet">Defeat ${zone.titans[i-1].name} first</div>
        </div></div>
      </div>`;
      const pct = titan.currentHP / titan.maxHP * 100;
      const sGain = Math.floor(titan.reward.souls * soulMultiplier());
      const am2   = arcaneUpgradeMults();
      const faithGain = Math.floor(titan.reward.faith * am2.titanLeyMult);
      const fillClass = pct<25?'low':pct<60?'med':'';
      // Titan stats
      const tAtk = titan.baseAtk || 0;
      const tDef = titan.baseDef || 0;
      const tHP  = titan.maxHP;
      // Best 3 summons
      const best3 = getBestSummons(3);
      const hasParty = best3.length > 0;
      const partyIcons = best3.map(s=>s.icon).join(' ');
      const partyAtk   = best3.reduce((s,x)=>s+x.totalAtk,0);
      return `<div class="titan-card">
        <div class="titan-header">
          <div><div class="titan-name">${titan.name}</div><div class="titan-epithet">${titan.epithet}</div></div>
          <span class="titan-icon">${titan.icon}</span>
        </div>
        <div class="titan-desc">${titan.desc}</div>
        <div class="titan-stats">
          <div class="titan-stat t-atk">
            <span class="titan-stat-icon">‚öîÔ∏è</span>
            <span class="titan-stat-label">Attack</span>
            <span class="titan-stat-value">${fmt(tAtk)}</span>
          </div>
          <div class="titan-stat t-def">
            <span class="titan-stat-icon">üõ°Ô∏è</span>
            <span class="titan-stat-label">Defense</span>
            <span class="titan-stat-value">${fmt(tDef)}</span>
          </div>
          <div class="titan-stat t-hp">
            <span class="titan-stat-icon">‚ù§Ô∏è</span>
            <span class="titan-stat-label">HP</span>
            <span class="titan-stat-value">${fmt(tHP)}</span>
          </div>
        </div>
        <div class="hp-bar-wrap">
          <div class="hp-label"><span>${titan.defeated?'‚úì SLAIN':fmt(titan.currentHP)+' / '+fmt(titan.maxHP)+' HP'}</span><span>${Math.floor(pct)}%</span></div>
          <div class="hp-bar"><div class="hp-fill ${fillClass}" style="width:${titan.defeated?0:pct}%"></div></div>
        </div>
        <div class="battle-party">
          ${hasParty
            ? `<span class="battle-party-icons">${partyIcons}</span>
               <div><div class="battle-party-label">YOUR PARTY  ¬∑  ${fmt(partyAtk)} vs ${fmt(tDef)} DEF</div></div>`
            : `<span class="battle-party-none">‚ö† No summons! Summon creatures to fight.</span>`}
        </div>
        <div class="battle-meta">
          <div class="rewards-txt">Reward: <span>${fmt(faithGain)} Ley Power</span> ¬∑ <span>${sGain} Souls</span></div>
        </div>
        <button class="battle-btn ${titan.defeated?'victory':''}" data-titanid="${titan.id}" ${titan.defeated?'disabled':''}>
          ${titan.defeated?'‚ú¶ Titan Defeated':'‚öî Strike '+titan.name}
        </button>
      </div>`;
    }).join('') +
    `</div>`;
}

function renderTranscendTab() {
  if (G.currentTab !== 'transcend') return;
  const c = document.getElementById('transcend-content');
  if (!c) return;
  const gain = calcDivinityGain();
  const avail = PRESTIGE_UPGRADES.filter(u=>!u.bought && u.req());
  const done  = PRESTIGE_UPGRADES.filter(u=>u.bought);
  c.innerHTML = `
    <div class="transcend-main">
      <h3>‚ú¶ Transcendence</h3>
      <div class="dust-orb">‚ú®</div>
      <div class="transcend-stat">Arcane Dust: <strong>${fmt(G.dust)}</strong></div>
      <div class="transcend-stat">Next reset gains: <strong>+${gain} Arcane Dust</strong></div>
      <div class="transcend-stat">Multiplier: <strong>√ó${G.divineMultiplier.toFixed(2)}</strong></div>
      <div class="transcend-stat">Transcensions: <strong>${G.prestiges}</strong></div>
      <button class="transcend-btn" onclick="doPrestige()" ${gain<1?'disabled':''}>
        ‚ú¶ TRANSCEND NOW ‚ú¶
      </button>
      <div style="font-size:11px;color:var(--marble-dim);margin-top:10px;font-style:italic">
        ${(()=>{
          const base=getTranscendBase();
          if(G.faithTotal<base) return 'Need '+fmt(base)+' lifetime Ley Power to Transcend';
          const exact=calcDivinityGainExact();
          if(exact>=3) return 'Maximum Divinity gain reached (√ó3)';
          const nextWhole=Math.ceil(exact);
          const nextThresh=base*Math.pow(2,(nextWhole-1)/0.25);
          return 'Gain '+gain+' Divinity on reset ¬∑ Next tier at '+fmt(nextThresh)+' lifetime Ley';
        })()}
      </div>
    </div>
    <div class="transcend-upgrades-col">
      <div class="section-head">‚ú¶ Arcane Dust Upgrades</div>
      ${avail.map(up=>{
        const can = G.dust >= up.cost;
        return `<div class="card ${can?'':'disabled'}" onclick="buyUpgrade('${up.id}')" style="border-color:rgba(167,139,250,0.3)">
          <div class="card-header"><div class="card-icon-name"><span class="card-icon">${up.icon}</span>
            <div><div class="card-name" style="color:var(--gold)">${up.name}</div><div class="card-desc">${up.desc}</div></div></div></div>
          <div class="card-cost">Cost: <span style="color:var(--gold)">${up.cost} Arcane Dust</span></div>
        </div>`;
      }).join('')}
      ${done.length>0?`<hr class="section-divider">`+done.map(up=>`
        <div style="display:flex;gap:8px;align-items:center;padding:5px 6px;border:1px solid rgba(167,139,250,0.2);border-radius:4px;margin-bottom:5px;background:rgba(167,139,250,0.06)">
          <span style="font-size:16px">${up.icon}</span><span style="font-family:'Cinzel',serif;font-size:11px;color:var(--gold)">${up.name} ‚úì</span>
        </div>`).join(''):''}
    </div>`;
}

function renderSkillTree() {
  if (G.currentTab !== 'skilltree') return;
  const sp = document.getElementById('sp-display');
  if (sp) sp.textContent = G.skillPoints;

  const tree = document.getElementById('skill-tree');
  if (!tree) return;

  // Group by row
  const rows = {};
  SKILLS.forEach(sk => { (rows[sk.row]=rows[sk.row]||[]).push(sk); });

  tree.innerHTML = '';
  const rowCount = Math.max(...Object.keys(rows).map(Number))+1;

  for (let r = 0; r < rowCount; r++) {
    const skills = (rows[r]||[]).sort((a,b)=>a.col-b.col);

    // Connector above row (except row 0)
    if (r > 0) {
      const connRow = document.createElement('div');
      connRow.style.cssText = 'display:flex;flex-direction:row;gap:0;align-items:center;justify-content:center';
      // For each skill, draw a vertical connector if it has a req in prev row
      skills.forEach((sk,i) => {
        const active = sk.req.some(rid => SKILLS.find(s=>s.id===rid)?.level > 0);
        if (i > 0) { const sp2 = document.createElement('div'); sp2.style.cssText='flex:1'; connRow.appendChild(sp2); }
        const conn = document.createElement('div');
        conn.className = 'skill-connector' + (active?' active':'');
        conn.style.margin='0 auto';
        connRow.appendChild(conn);
      });
      tree.appendChild(connRow);
    }

    const rowEl = document.createElement('div');
    rowEl.className = 'skill-row';

    skills.forEach((sk, i) => {
      if (i > 0) {
        const hconn = document.createElement('div');
        const prevMaxed = skills[i-1].level > 0 && sk.level > 0;
        hconn.className = 'skill-h-connector' + (prevMaxed?' active':'');
        rowEl.appendChild(hconn);
      }

      const unlocked = skillUnlocked(sk);
      const maxed = sk.level >= sk.maxLevel;
      const canBuy = unlocked && !maxed && G.skillPoints >= sk.cost;
      const nodeClass = maxed ? 'maxed-skill' : unlocked&&sk.level>0 ? 'unlocked-skill' : !unlocked ? 'locked-skill' : '';

      const node = document.createElement('div');
      node.className = `skill-node ${nodeClass}`;
      node.innerHTML = `<div class="sn-icon">${sk.icon}</div>
        <div class="sn-name">${sk.name}</div>
        <div class="sn-level">${maxed?'MAX':sk.level+'/'+sk.maxLevel}</div>`;

      node.addEventListener('mouseenter', e => showSkillTooltip(sk, e));
      node.addEventListener('mousemove',  e => moveSkillTooltip(e));
      node.addEventListener('mouseleave', hideSkillTooltip);
      node.addEventListener('click', () => { if (canBuy) { buySkill(sk.id); } });

      rowEl.appendChild(node);
    });
    tree.appendChild(rowEl);
  }
}

function showSkillTooltip(sk, e, color) {
  const tt = document.getElementById('skill-tooltip');
  const unlocked = skillUnlocked(sk);
  const maxed = sk.level >= sk.maxLevel;
  const col = color || 'var(--gold)';
  tt.innerHTML = '<div class="stt-name" style="color:' + col + '">' + sk.icon + ' ' + sk.name + '</div>' +
    '<div class="stt-desc">' + sk.desc + '</div>' +
    '<div class="stt-effect">Effect: ' + sk.effect + '</div>' +
    '<div class="stt-cost">' + (maxed ? '‚úì Maxed' : unlocked ? 'Cost: ' + sk.cost + ' Skill Points' : 'üîí Unlock prerequisites first') + '</div>' +
    (sk.level > 0 ? '<div style="font-size:11px;color:var(--gold-dim);margin-top:3px">Level: ' + sk.level + '/' + sk.maxLevel + '</div>' : '');
  tt.className = 'skill-tooltip visible';
  moveSkillTooltip(e);
}
function moveSkillTooltip(e) {
  const tt = document.getElementById('skill-tooltip');
  tt.style.left = (e.clientX+14)+'px';
  tt.style.top  = (e.clientY-10)+'px';
}
function hideSkillTooltip() {
  document.getElementById('skill-tooltip').className='skill-tooltip';
}

function renderChronicle() {
  if (G.currentTab !== 'transcend') return;
  const ll = document.getElementById('log-list');
  if (ll) ll.innerHTML = LOG_ENTRIES.slice(0,30).map(e=>`<div class="log-entry ${e.type}">${e.msg}</div>`).join('');
  const ml = document.getElementById('milestones-list');
  if (ml) ml.innerHTML = MILESTONES.map(m=>`
    <div class="milestone ${m.unlocked?'unlocked':''}">
      <span class="m-icon">${m.icon}</span>
      <div><div class="m-name">${m.name}</div><div class="m-desc">${m.desc}</div></div>
    </div>`).join('');
}

function updateHeader() {
  const fps = calcFPS(); G.faithPerSec = fps;
  document.getElementById('faith-display').textContent = fmt(G.faith);
  document.getElementById('faith-rate').textContent     = `+${fmt(fps)}/s`;
  document.getElementById('dust-display').textContent   = fmt(G.dust);
  document.getElementById('prestige-count').textContent = `Transcensions: ${G.prestiges}`;

}

function switchMainTab(tab) {
  G.currentTab = tab;
  document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('nav-'+tab)?.classList.add('active');
  document.querySelectorAll('.tab-pane').forEach(p=>{ p.classList.remove('active'); p.style.display='none'; });
  const pane = document.getElementById('pane-'+tab);
  if (pane) { pane.classList.add('active'); pane.style.display = tab==='click'?'flex':'block'; }
  renderTabContent();
}

function renderTabContent() {
  switch(G.currentTab) {
    case 'click':     renderClickTab();     break;
    case 'summons':   renderSummonsTab();   break;
    case 'titans':    renderTitansTab();    break;
    case 'transcend': renderTranscendTab(); break;
    case 'skilltree': renderSkillTree();    break;
  }
}

// =====================================================
// SAVE / LOAD / RESET
// =====================================================
const SAVE_KEY = 'heracles_academy_save';

function showToast(msg) {
  const t = document.getElementById('save-toast');
  if (!t) return;
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(t._tid);
  t._tid = setTimeout(() => t.classList.remove('show'), 2200);
}

function saveGame() {
  try {
    const save = {
      v: 1,
      G: { ...G },
      summons:    SUMMONS.map(s  => ({ id: s.id,  owned:   s.owned   })),
      upgrades:   ALL_UPGRADES.map(u => ({ id: u.id, bought: u.bought })),
      arcane:     ARCANE_UPGRADES.map(a => ({ id: a.id, level: a.level })),
      titans:     TITAN_STATE.map(t  => ({ id: t.id,  currentHP: t.currentHP, defeated: t.defeated })),
      skills:     SKILLS.map(sk => ({ id: sk.id, level: sk.level })),
      milestones: MILESTONES.map(m  => ({ id: m.id,  unlocked: m.unlocked })),
      ac:         { active: AC.active, interval: AC.interval, totalFired: AC.totalFired },
      acUpgrades: AC_UPGRADES.map(u => ({ id: u.id, bought: u.bought })),
    };
    localStorage.setItem(SAVE_KEY, JSON.stringify(save));
    showToast('‚ú¶ Game Saved');
  } catch(e) {
    showToast('‚ö† Save failed: ' + e.message);
  }
}

function loadGame() {
  try {
    const raw = localStorage.getItem(SAVE_KEY);
    if (!raw) { showToast('‚ö† No save found'); return; }
    const save = JSON.parse(raw);
    if (!save || save.v !== 1) { showToast('‚ö† Save format invalid'); return; }

    Object.assign(G, save.G);

    if (save.summons)    save.summons.forEach(s => { const m = SUMMONS.find(x => x.id === s.id);         if (m) m.owned   = s.owned   || 0; });
    if (save.upgrades)   save.upgrades.forEach(u => { const m = ALL_UPGRADES.find(x => x.id === u.id);   if (m) m.bought  = u.bought  || false; });
    if (save.arcane)     save.arcane.forEach(a => { const m = ARCANE_UPGRADES.find(x => x.id === a.id);  if (m) m.level   = a.level   || 0; });
    if (save.titans)     save.titans.forEach(t => {
      const m = TITAN_STATE.find(x => x.id === t.id);
      if (m) { m.currentHP = t.currentHP; m.defeated = t.defeated || false; }
    });
    if (save.skills)     save.skills.forEach(s => { const m = SKILLS.find(x => x.id === s.id);           if (m) m.level   = s.level   || 0; });
    if (save.milestones) save.milestones.forEach(ms => { const m = MILESTONES.find(x => x.id === ms.id); if (m) m.unlocked = ms.unlocked || false; });
    if (save.ac)         { AC.active = save.ac.active || false; AC.interval = save.ac.interval || 5.0; AC.totalFired = save.ac.totalFired || 0; }
    if (save.acUpgrades) save.acUpgrades.forEach(u => { const m = AC_UPGRADES.find(x => x.id === u.id);  if (m) m.bought  = u.bought  || false; });

    G.divineMultiplier = calcDivineMultiplier();
    renderAll();
    showToast('‚ú¶ Game Loaded');
  } catch(e) {
    showToast('‚ö† Load failed: ' + e.message);
  }
}

function resetGame() {
  if (!confirm('‚ö† Reset ALL progress?\n\nThis permanently deletes your save. Cannot be undone.')) return;
  localStorage.removeItem(SAVE_KEY);
  Object.assign(G, { faith:0, faithTotal:0, faithPerClick:1, faithPerSec:0, dust:0, prestiges:0, divineMultiplier:1, selectedZone:1, skillPoints:0, totalSkillPoints:0, tick:0, currentTab:'click', totalClicks:0 });
  SUMMONS.forEach(s  => s.owned   = 0);
  ALL_UPGRADES.forEach(u => u.bought = false);
  ARCANE_UPGRADES.forEach(a => a.level = 0);
  TITAN_STATE.forEach((t, i) => { t.currentHP = TITANS_DATA[i].maxHP; t.defeated = false; });
  SKILLS.forEach(sk => sk.level = 0);
  MILESTONES.forEach(m => m.unlocked = false);
  AC.active = false; AC.interval = 5.0; AC.timer = 0; AC.totalFired = 0;
  AC_UPGRADES.forEach(u => u.bought = false);
  renderAll();
  showToast('‚ú¶ Game Reset');
}

// Auto-save every 60 seconds
setInterval(saveGame, 60000);

function renderAll() {
  updateHeader();
  renderTabContent();
}

// =====================================================
// AUTO-CLICK
// =====================================================
const AC = {
  active: false,
  interval: 5.0,   // seconds between auto-taps
  timer: 0,        // counts up toward interval
  totalFired: 0,
};

const AC_UPGRADES = [
  { id:'ac1', name:'Ley Resonance',    icon:'„Ä∞Ô∏è', desc:'Auto-tap every 4s instead of 5s.',   cost:5000,                   currency:'faith', interval:4.0, bought:false, req:()=>AC.active },
  { id:'ac2', name:'Harmonic Pulse',   icon:'üåä', desc:'Reduces interval to 3s.',              cost:5000*50000,             currency:'faith', interval:3.0, bought:false, req:()=>AC_UPGRADES[0].bought },
  { id:'ac3', name:'Ley Surge',        icon:'‚ö°', desc:'Reduces interval to 2s.',              cost:5000*50000*50000,       currency:'faith', interval:2.0, bought:false, req:()=>AC_UPGRADES[1].bought },
  { id:'ac4', name:'Arcane Overdrive', icon:'üîÆ', desc:'Reduces interval to 1s.',              cost:5000*50000*50000*50000, currency:'faith', interval:1.0, bought:false, req:()=>AC_UPGRADES[2].bought },
  { id:'ac5', name:'Temporal Mastery', icon:'‚è±Ô∏è', desc:'Reduces interval to 0.5s.',            cost:5000*Math.pow(50000,4), currency:'faith', interval:0.5, bought:false, req:()=>AC_UPGRADES[3].bought },
];

function calcACInterval() {
  let interval = 5.0;
  [...AC_UPGRADES].reverse().forEach(u => {
    if (u.bought) { interval = Math.min(interval, u.interval); }
  });
  return interval;
}

function activateAutoClick() {
  if (AC.active) return;
  if (G.faith < 250) return;
  G.faith -= 250;
  AC.active = true;
  AC.timer = 0;
  log('Arcane Auto-Tap activated! The ley lines tap themselves.', 'divine');
  renderACPanel();
  updateHeader();
}

function buyACUpgrade(id) {
  const up = AC_UPGRADES.find(u=>u.id===id);
  if (!up || up.bought || !up.req()) return;
  const val = up.currency==='faith' ? G.faith : G.dust;
  if (val < up.cost) return;
  if (up.currency==='faith') G.faith -= up.cost;
  else G.dust -= up.cost;
  up.bought = true;
  AC.interval = calcACInterval();
  log(`Auto-tap upgraded: ${up.name}! Interval now ${AC.interval}s.`, 'divine');
  renderACPanel();
  updateHeader();
}

function renderACPanel() {
  if (G.currentTab !== 'click') return;

  const btn    = document.getElementById('ac-activate-btn');
  const dot    = document.getElementById('ac-dot');
  const stxt   = document.getElementById('ac-status-text');
  const body   = document.getElementById('ac-body');
  const upgDiv = document.getElementById('ac-upgrades');

  if (!btn) return;

  // Button state
  if (AC.active) {
    btn.style.display = 'none';
    dot.className = 'ac-dot active';
    stxt.textContent = 'ACTIVE';
    stxt.className = 'ac-status-text active';
    body.style.display = 'flex';
    upgDiv.style.display = 'grid';
  } else {
    btn.style.display = '';
    btn.disabled = G.faith < 250;
    dot.className = 'ac-dot';
    stxt.textContent = 'INACTIVE';
    stxt.className = 'ac-status-text';
    body.style.display = 'none';
    upgDiv.style.display = 'none';
    return;
  }

  // Ring progress
  const interval = calcACInterval();
  const pct = Math.min(1, AC.timer / interval);
  const circumference = 2 * Math.PI * 27; // r=27
  const fill = document.getElementById('ac-ring-fill');
  const ringLabel = document.getElementById('ac-ring-label');
  const remaining = Math.max(0, interval - AC.timer).toFixed(1);
  if (fill) {
    fill.style.strokeDashoffset = circumference * (1 - pct);
    fill.className = pct >= 0.99 ? 'ac-ring-fill ready' : 'ac-ring-fill';
  }
  if (ringLabel) ringLabel.textContent = remaining;

  const intDisp = document.getElementById('ac-interval-display');
  if (intDisp) intDisp.textContent = interval.toFixed(1) + 's';
  const nextTxt = document.getElementById('ac-next-click');
  if (nextTxt) nextTxt.textContent = pct >= 0.99 ? '‚ö° Tapping now...' : `Next tap in ${remaining}s`;
  const totalEl = document.getElementById('ac-total-clicks');
  if (totalEl) totalEl.textContent = `${AC.totalFired.toLocaleString()} auto-tap${AC.totalFired!==1?'s':''} fired`;

  // Speed upgrades
  upgDiv.innerHTML = AC_UPGRADES.map(u => {
    const unlocked = u.req();
    const lbl = u.currency==='faith'?'Ley Power':'Titan Souls';
    const val = u.currency==='faith'?G.faith:G.dust;
    const can = unlocked && !u.bought && val >= u.cost;
    const cls = u.bought ? 'bought' : (!unlocked || val < u.cost) ? 'disabled' : '';
    return `<div class="ac-upg-card ${cls}" data-acupgid="${u.id}">
      <div class="ac-upg-header">
        <span class="ac-upg-icon">${u.icon}</span>
        <span class="ac-upg-name">${u.name}</span>
      </div>
      <div class="ac-upg-desc">${u.desc}</div>
      <div class="ac-upg-cost">${u.bought ? '‚úì Purchased' : `Cost: <span>${u.cost.toLocaleString()} ${lbl}</span>`}</div>
    </div>`;
  }).join('');
}

// =====================================================
// GAME LOOP
// =====================================================
let lastTick = Date.now();
setInterval(() => {
  const now = Date.now();
  const dt = (now-lastTick)/1000;
  lastTick = now;

  const fps = calcFPS();
  G.faith += fps*dt; G.faithTotal += fps*dt;
  G.tick++;

  // Auto-click timer
  if (AC.active) {
    AC.timer += dt;
    const interval = calcACInterval();
    if (AC.timer >= interval) {
      AC.timer -= interval;
      const cp = calcClickPower();
      G.faith += cp; G.faithTotal += cp;
      AC.totalFired++;
      checkMilestones();
    }
    if (G.currentTab === 'click') renderACPanel();
  }

  updateHeader();
  if (G.tick % 5 === 0) { checkMilestones(); renderTabContent(); }
}, 100);

// =====================================================
// STARS
// =====================================================
(function(){
  const stars = document.getElementById('stars');
  for (let i=0;i<120;i++) {
    const s = document.createElement('div'); s.className='star';
    const size=Math.random()*2+0.5, dur=2+Math.random()*4;
    s.style.cssText=`width:${size}px;height:${size}px;left:${Math.random()*100}%;top:${Math.random()*100}%;--d:${dur}s;--min:${0.1+Math.random()*0.2};--max:${0.4+Math.random()*0.5};animation-delay:${Math.random()*4}s;`;
    stars.appendChild(s);
  }
})();

// =====================================================
// DELEGATED EVENT LISTENERS (for data-attribute cards)
// =====================================================
document.addEventListener('click', function(e) {
  // Arcane upgrades
  const auCard = e.target.closest('[data-auid]');
  if (auCard) { buyArcaneUpgrade(auCard.dataset.auid); return; }

  // Summon cards
  const sumCard = e.target.closest('[data-summonid]');
  if (sumCard) { buySummon(sumCard.dataset.summonid); return; }

  // AC upgrade cards
  const acCard = e.target.closest('[data-acupgid]');
  if (acCard) { buyACUpgrade(acCard.dataset.acupgid); return; }

  // Zone selector tabs
  const zoneTab = e.target.closest('[data-zone]');
  if (zoneTab) { G.selectedZone = parseInt(zoneTab.dataset.zone); renderTitansTab(); return; }

  // Titan battle buttons
  const titanBtn = e.target.closest('[data-titanid]');
  if (titanBtn && !titanBtn.disabled) { attackTitan(titanBtn.dataset.titanid); return; }
});

// Expose all interactive functions to global scope explicitly
window.saveGame         = saveGame;
window.loadGame         = loadGame;
window.resetGame        = resetGame;
window.clickAltar       = clickAltar;
window.buyUpgrade       = buyUpgrade;
window.buySummon        = buySummon;
window.attackTitan      = attackTitan;
window.doPrestige       = doPrestige;
window.activateAutoClick= activateAutoClick;
window.buyACUpgrade     = buyACUpgrade;
window.buyArcaneUpgrade = buyArcaneUpgrade;
window.buySkill         = buySkill;
window.switchMainTab    = switchMainTab;

// =====================================================
// INIT
// =====================================================
log('The halls of Heracles\' Academy open before you...', 'divine');
log('Tap the Ley Lines to gather power. Build arcane upgrades. Summon legends.', '');
if (localStorage.getItem(SAVE_KEY)) {
  loadGame();
  log('‚ú¶ Save file detected ‚Äî game restored.', 'divine');
} else {
  renderAll();
}
</script>
</body>
</html>
